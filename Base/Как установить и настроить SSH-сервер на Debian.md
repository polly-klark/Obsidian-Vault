#linux #debian #ssh

# Основные понятия

**Debian** — это одна из самых популярных и распространенных операционных систем Linux (GNU). Дистрибутив разработан по принципу свободного ПО с открытым исходным кодом. Debian является универсальной операционной системой, поскольку подходит как для повседневного использования, так и для специфической работы на серверах. Она оказала значительное влияние на развитие подобного типа ОС.

Нередко на Debian приходится настраивать SSH-сервер. **SSH** (от англ. **S**ecure **SH**ell ― безопасная оболочка) ― это один из сетевых протоколов безопасности, который позволяет удаленно подключаться к серверу и управлять им. Протокол работает по принципу взаимодействия двух сторон — клиента и сервера. Он требует аутентификации сторон одним из способов: по IP-адресу, по паролю или с помощью ключевой пары. Secure Shell по умолчанию проводит соединения по порту 22. Подробнее читайте [в статье](https://help.reg.ru/support/hosting/dostupy-i-podklyucheniye-panel-upravleniya-ftp-ssh/chto-takoye-ssh).

Лучшим инструментом для работы по SSH на сервере является OpenSSH. **OpenSSH** (**O**pen **S**ecure **SH**ell) — набор утилит, который работает на базе протокола SSH и позволяет шифровать сеансы связи в процессе работы через сеть. Благодаря Secure Shell можно в режиме реального времени удаленно посылать команды на сервер и обмениваться с ним данными. OpenSSH содержит такие компоненты, как SCP, SFTP, SFTP-server и другие. Этот комплект ПО аутентифицирует пользователей с помощью нескольких встроенных механизмов: вызов-отклик, публичные ключи, протокол аутентификации **kerberos** и интерфейс GSS-AP.

Чтобы настроить защищенное соединение на Debian, необходимо не только установить набор программ OpenSSH, но и внести дополнительные настройки. О том, как это сделать, мы рассказали в инструкциях ниже.

# Как установить OpenSSH

1. Откройте терминал
2. Обновите список пакетов:
`sudo apt-get update`
3. Установите OpenSSH:
`sudo apt-get install openssh-server`
4. Если вы используете МЭ UFW, нужно разрешить удалённое подключение к порту 22:
`sudo ufw allow ssh`
5. Проверьте работу SSH-сервера:
`sudo systemctl status ssh`
Если установка прошла корректно, вы увидите следующее сообщение:

![[Pasted image 20240416122008.png]]

Статус «active (running)» означает, что server запущен. Также в строке «Server listening on» вы увидите порт, через который работает SSH.

# Как изменить порт для OpenSSH

По умолчанию OpenSSH использует порт 22. Этот порт нужно изменить по следующим причинам:

- **из соображений безопасности**. Если сервер просканируют боты и обнаружат, что он отвечает по открытому порту 22, они могут попытаться подобрать пароль;
- **для доступности сервера**. Если порт 22 занят другой службой — например, веб-сервером — сервер SSH не будет работать.

Все настройки нужно сделать в конфигурационном файле. **Чтобы изменить порт**:

1. Откройте терминал
2. Создайте резервную копию конфигурационного файла:
`sudo cp /etc/ssh/sshd_config{,_back}`
3. Откройте конфигурационный файл:
`sudo nano /etc/ssh/sshd_config`
4. Раскомментируйте строку «Port» и замените порт 22 на значение в диапазоне от 1 до 65 535. Проверьте, чтобы новый порт не был занят другой службой:

![[Pasted image 20240416122814.png]]

5. Чтобы применить изменения, перезагрузите SSH-сервер:
`sudo systemctl restart sshd`
6. Для подключения используйте команду:
`sudo user@host -p 1234`

# Как отключить вход для суперпользователя OpenSSH

Перед тем, как отключить вход для суперпользователя убедитесь, что создан хотя бы еще один пользователь. После этого:

1. Откройте терминал
2. Создайте резервную копию конфигурационного файла:
`sudo cp /etc/ssh/sshd_config{,_back}`
3. Откройте конфигурационный файл:
`sudo nano /etc/ssh/sshd_config`
4. Раскомментируйте строку «PermitRootLogin» и укажите значение «no»:

![[Pasted image 20240416123621.png]]

Вы можете изменить решение: для этого в строке «PermitRootLogin» укажите значение «yes».
5. Чтобы применить изменения, перезагрузите SSH-сервер:
`sudo systemctl restart sshd`

# Как настроить авторизацию по ключу

Перед настройкой убедитесь, что у вас создана ключевая пара.

## Как создать ключевую пару

1. Откройте терминал и выполните команду:
`sudo systemctl restart sshd`
2. Система предложит директорию, в которой будут сохранены ключи.
3. Введите пароль, чтобы защитить открытый ключ
4. Скопируйте открытый ключ:
`ssh-copy-id user@host -p 1234`

1. Откройте терминал
2. Создайте резервную копию конфигурационного файла:
`sudo cp /etc/ssh/sshd_config{,_back}`
3. Откройте конфигурационный файл:
`sudo nano /etc/ssh/sshd_config`
4. Раскомментируйте строку «PubkeyAuthentication» и укажите в ней значение «yes»:

![[Pasted image 20240416124405.png]]

5. Чтобы применить изменения, перезагрузите SSH-сервер:
`sudo systemctl restart sshd`