#network #htb #crypto 

`Virtual Private Network` (`VPN`) — это технология, которая обеспечивает безопасное и зашифрованное соединение между частной сетью и удалённым устройством. Это позволяет удалённому устройству напрямую подключаться к частной сети, обеспечивая безопасный и конфиденциальный доступ к ресурсам и службам сети. Например, администратору из другого региона необходимо управлять внутренними серверами, чтобы сотрудники могли продолжать пользоваться внутренними сервисами. Многие компании ограничивают доступ к серверам, поэтому клиенты могут подключаться к ним только из локальной сети. Здесь в игру вступает VPN: администратор подключается к VPN-серверу через Интернет, проходит аутентификацию и таким образом создаёт зашифрованный туннель, чтобы другие пользователи не могли прочитать передаваемые данные. Кроме того, компьютеру администратора присваивается локальный (внутренний) IP-адрес, с помощью которого он может получать доступ к внутренним серверам и управлять ими. Администраторы обычно используют VPN для обеспечения безопасного и экономичного удалённого доступа к сети компании. VPN обычно использует порты `TCP/1723` для VPN-подключений по протоколу [туннелирования «точка-точка»](https://www.lifewire.com/pptp-point-to-point-tunneling-protocol-818182) `PPTP` и `UDP/500` для VPN-подключений по протоколам [IKEv1](https://www.cisco.com/c/en/us/support/docs/security-vpn/ipsec-negotiation-ike-protocols/217432-understand-ipsec-ikev1-protocol.html) и [IKEv2](https://nordvpn.com/blog/ikev2ipsec/).

Это позволяет сотрудникам получать доступ к сети и её ресурсам, таким как электронная почта и файловые серверы, из удалённых мест, например из дома или во время поездок. Администраторы используют VPN по нескольким причинам. VPN-сервисы шифруют соединение между удалённым устройством и частной сетью, что значительно затрудняет перехват и кражу конфиденциальной информации злоумышленниками. Благодаря этому повышается безопасность всей коммуникации.

Другая причина заключается в том, что VPN позволяют сотрудникам получать удалённый доступ к частной сети и её ресурсам из любого места, где есть подключение к интернету. Это особенно удобно для сотрудников, которым приходится работать удалённо, например во время поездок или из дома. Кроме того, VPN могут быть более экономичными, чем другие решения для удалённого доступа, такие как выделенные линии или выделенные подключения, поскольку они используют общедоступный интернет для подключения удалённых пользователей к частной сети.

Кроме того, с помощью VPN можно объединить несколько удаленных объектов, например филиалов, в единую частную сеть, что упрощает управление сетевыми ресурсами и доступ к ним. Однако для работы VPN необходимы определенные компоненты и условия:

|**Требование**|**Описание**|
|---|---|
|`VPN Client`|Он устанавливается на удалённом устройстве и используется для установления и поддержания VPN-соединения с VPN-сервером. Например, это может быть клиент OpenVPN.|
|`VPN Server`|Это компьютер или сетевое устройство, отвечающее за приём VPN-подключений от VPN-клиентов и маршрутизацию трафика между VPN-клиентами и частной сетью.|
|`Encryption`|VPN-подключения шифруются с использованием различных алгоритмов и протоколов шифрования, таких как AES и IPsec, для обеспечения безопасности соединения и защиты передаваемых данных.|
|`Authentication`|Для установления безопасного соединения VPN-сервер и клиент должны пройти взаимную аутентификацию с использованием общего секрета, сертификата или другого метода аутентификации.|

VPN-клиент и VPN-сервер используют эти порты для установления и поддержания VPN-соединения. На уровне TCP/IP VPN-соединение обычно использует протокол [инкапсуляции полезной нагрузки](https://www.ibm.com/docs/en/i/7.4?topic=protocols-encapsulating-security-payload) (`ESP`) для шифрования и аутентификации VPN-трафика. Это позволяет VPN-клиенту и VPN-серверу безопасно обмениваться данными через общедоступный интернет.

---

## IPSec

[Internet Protocol Security](https://www.cloudflare.com/learning/network-layer/what-is-ipsec/) (`IPsec`) — это протокол сетевой безопасности, который обеспечивает шифрование и аутентификацию интернет-коммуникаций. Это мощный и широко используемый протокол безопасности, который обеспечивает шифрование и аутентификацию интернет-коммуникаций. Он работает за счёт шифрования полезной нагрузки каждого IP-пакета и добавления `authentication header` (`AH`), который используется для проверки целостности и подлинности пакета. IPsec использует комбинацию двух протоколов для обеспечения шифрования и аутентификации:

1. [Заголовок аутентификации](https://www.ibm.com/docs/en/i/7.1?topic=protocols-authentication-header) (`AH`): этот протокол обеспечивает целостность и подлинность IP-пакетов, но не обеспечивает их шифрование. Он добавляет к каждому IP-пакету заголовок аутентификации, содержащий криптографическую контрольную сумму, которую можно использовать для проверки подлинности пакета.
    
2. [Инкапсуляция полезной нагрузки для обеспечения безопасности](https://www.ibm.com/docs/en/i/7.4?topic=protocols-encapsulating-security-payload) (`ESP`): этот протокол обеспечивает шифрование и опциональную аутентификацию IP-пакетов. Он шифрует полезную нагрузку каждого IP-пакета и при необходимости добавляет заголовок аутентификации, аналогичный AH.
    

IPsec можно использовать в двух режимах.

|**Режим**|**Описание**|
|---|---|
|`Transport Mode`|В этом режиме IPsec шифрует и проверяет подлинность полезной нагрузки каждого IP-пакета, но не шифрует IP-заголовок. Обычно этот режим используется для обеспечения сквозной защиты связи между двумя хостами.|
|`Tunnel Mode`|В этом режиме IPsec шифрует и проверяет подлинность всего IP-пакета, включая IP-заголовок. Обычно этот режим используется для создания VPN-туннеля между двумя сетями.|

Например, администратор может установить брандмауэр. Чтобы обеспечить передачу IPsec VPN-трафика от VPN-клиента, находящегося за пределами брандмауэра, к VPN-серверу, находящемуся внутри брандмауэра, брандмауэр должен поддерживать следующие протоколы:

|**Протокол**|**Портвейн**|**Описание**|
|---|---|---|
|`Internet Protocol` (`IP`)|`UDP/50-51`|Это основной протокол, который обеспечивает основу для всех интернет-коммуникаций. Он используется для маршрутизации пакетов данных между VPN-клиентом и VPN-сервером.|
|`Internet Key Exchange` (`IKE`)|`UDP/500`|IKE — это протокол, который используется для установления и поддержания безопасной связи между VPN-клиентом и VPN-сервером. Он основан на алгоритме обмена ключами Диффи — Хеллмана и используется для согласования и установки общих секретных ключей, которые можно использовать для шифрования и дешифрования VPN-трафика.|
|`Encapsulating Security Payload` (`ESP`)|`UDP/4500`|ESP — это также протокол, обеспечивающий шифрование и аутентификацию IP-дейтаграмм. Он используется для шифрования VPN-трафика между VPN-клиентом и VPN-сервером с помощью ключей, согласованных с IKE.|

Эти протоколы необходимы для передачи VPN-трафика по IPsec, поскольку они обеспечивают безопасность и шифрование, необходимые для безопасной связи через общедоступный интернет. Без этих протоколов VPN-трафик был бы уязвим для перехвата и несанкционированного доступа.

---

## PPTP

[Протокол туннелирования "Точка-точка"](https://www.vpnranks.com/blog/pptp-vs-l2tp/) (`PPTP`) - сетевой протокол, который позволяет создавать VPN путем установления защищенного туннеля между VPN-клиентом и сервером, инкапсулируя данные, передаваемые в рамках этого туннеля. Первоначально PPTP был расширением протокола "Точка-точка" (PPP) и поддерживается многими операционными системами.

Однако из-за известных уязвимостей протокол PPTP больше не считается безопасным. Он может туннелировать такие протоколы, как IP, IPX или NetBEUI, через IP, но его в значительной степени вытеснили более безопасные протоколы VPN, такие как L2TP/IPsec, IPsec/IKEv2 и OpenVPN. С 2012 года использование PPTP сократилось, поскольку его метод аутентификации MSCHAPv2 использует устаревшее шифрование DES, которое можно легко взломать с помощью специализированного оборудования.