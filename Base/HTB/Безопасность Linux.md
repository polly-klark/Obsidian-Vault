#linux #htb 

Все компьютерные системы подвержены риску взлома. Некоторые из них более уязвимы, чем другие, например, веб-сервер, подключённый к интернету и размещающий несколько сложных веб-приложений. Системы Linux также менее подвержены вирусам, которые поражают операционные системы Windows, и не представляют такой большой поверхности атаки, как хосты, подключённые к домену Active Directory. Тем не менее, для защиты любой системы Linux необходимо соблюдать определённые базовые принципы.

Одной из важнейших мер безопасности в операционных системах Linux является обновление ОС и установленных пакетов. Это можно сделать с помощью такой команды:

  Безопасность Linux

```shell-session
Barlogsha@htb[/htb]$ apt update && apt dist-upgrade
```

Если правила брандмауэра не настроены должным образом на сетевом уровне, мы можем использовать брандмауэр Linux и/или `iptables` для ограничения входящего и исходящего трафика.

Если SSH-сервер открыт, необходимо настроить конфигурацию так, чтобы запретить вход по паролю и вход пользователя root по SSH. Также важно по возможности избегать входа в систему и управления ею от имени пользователя root и надлежащим образом управлять контролем доступа. Доступ пользователей должен определяться по принципу наименьших привилегий. Например, если пользователю нужно выполнить команду от имени root, то эту команду следует указать в `sudoers` конфигурации, а не предоставлять ему полные права sudo. Другой распространённый механизм защиты, который можно использовать, — это `fail2ban`. Этот инструмент подсчитывает количество неудачных попыток входа в систему, и если пользователь достиг максимального количества попыток, хост, с которого была предпринята попытка подключения, обрабатывается в соответствии с настройками.

Также важно периодически проверять систему, чтобы убедиться в отсутствии проблем, которые могут способствовать повышению привилегий, например, устаревшее ядро, проблемы с правами пользователей, файлы, доступные для записи всем пользователям, неправильно настроенные задания cron или службы. Многие администраторы забывают о том, что некоторые версии ядра необходимо обновлять вручную.

Для дополнительной защиты систем Linux можно использовать `Security-Enhanced Linux` (`SELinux`) или `AppArmor`. Это модуль безопасности ядра, который можно использовать для политик управления доступом. В SELinux каждому процессу, файлу, каталогу и системному объекту присваивается метка. Правила политики создаются для управления доступом между этими помеченными процессами и объектами и применяются ядром. Это означает, что можно настроить доступ таким образом, чтобы контролировать, какие пользователи и приложения могут получать доступ к каким ресурсам. SELinux обеспечивает очень детальный контроль доступа, например, позволяет указать, кто может добавлять данные в файл или перемещать его.

Кроме того, существуют различные приложения и сервисы, такие как [Snort](https://www.snort.org/), [chkrootkit](http://www.chkrootkit.org/), [rkhunter](https://packages.debian.org/sid/rkhunter), [Lynis](https://cisofy.com/lynis/) и другие, которые могут повысить безопасность Linux. Кроме того, необходимо выполнить некоторые настройки безопасности, например:

- Удаление или отключение всех ненужных служб и программного обеспечения
- Удаление всех служб, использующих незашифрованные механизмы аутентификации
- Убедитесь, что NTP включен и системный журнал запущен
- Убедитесь, что у каждого пользователя есть своя учетная запись
- Принудительное использование надежных паролей
- Настройте устаревание пароля и ограничьте использование предыдущих паролей
- Блокировка учетных записей пользователей после сбоев входа в систему
- Отключите все нежелательные двоичные файлы SUID / SGID

Этот список неполный, поскольку безопасность — это не продукт, а процесс. Это означает, что для более эффективной защиты систем всегда необходимо предпринимать конкретные шаги, и это зависит от того, насколько хорошо администраторы знают свои операционные системы. Чем лучше администраторы знакомы с системой и чем больше они обучены, тем эффективнее и надёжнее будут их меры безопасности.

---

## TCP Wrappers

TCP wrapper — это механизм безопасности, используемый в системах Linux, который позволяет системному администратору контролировать, каким службам разрешён доступ к системе. Он работает, ограничивая доступ к определённым службам на основе имени хоста или IP-адреса пользователя, запрашивающего доступ. Когда клиент пытается подключиться к службе, система сначала обращается к правилам, определённым в файлах конфигурации TCP-оболочек, чтобы определить IP-адрес клиента. Если IP-адрес соответствует критериям, указанным в файлах конфигурации, система предоставляет клиенту доступ к службе. Однако, если критерии не соблюдены, в подключении будет отказано, что обеспечит дополнительный уровень безопасности для сервиса. Оболочки TCP используют следующие файлы конфигурации:

- `/etc/hosts.allow`
    
- `/etc/hosts.deny`
    

Короче говоря, файл `/etc/hosts.allow` определяет, каким службам и хостам разрешён доступ к системе, а файл `/etc/hosts.deny` определяет, каким службам и хостам доступ запрещён. Эти файлы можно настроить, добавив в них определённые правила.

#### /etc/hosts.allow

  Безопасность Linux

```shell-session
Barlogsha@htb[/htb]$ cat /etc/hosts.allow

# Allow access to SSH from the local network
sshd : 10.129.14.0/24

# Allow access to FTP from a specific host
ftpd : 10.129.14.10

# Allow access to Telnet from any host in the inlanefreight.local domain
telnetd : .inlanefreight.local
```

#### /etc/hosts.deny

  Безопасность Linux

```shell-session
Barlogsha@htb[/htb]$ cat /etc/hosts.deny

# Deny access to all services from any host in the inlanefreight.com domain
ALL : .inlanefreight.com

# Deny access to SSH from a specific host
sshd : 10.129.22.22

# Deny access to FTP from hosts with IP addresses in the range of 10.129.22.0 to 10.129.22.255
ftpd : 10.129.22.0/24
```

Важно помнить, что *порядок правил в файлах имеет значение*. Будет применено первое правило, соответствующее запрошенной службе и хосту. Также важно отметить, что TCP-wrappers не заменяют брандмауэр, поскольку они ограничены тем, что могут контролировать только доступ к службам, а не к портам.