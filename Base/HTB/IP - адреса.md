#htb #network 

Каждый узел в сети, в которой он находится, можно идентифицировать по так называемому `Media Access Control` адресу (`MAC`). Это позволяет обмениваться данными в пределах одной сети. Если удалённый узел находится в другой сети, знания `MAC` адреса недостаточно для установления соединения. Адресация в Интернете осуществляется с помощью `IPv4` и/или `IPv6` адреса, который состоит из `network address` и `host address`.

Неважно, идёт ли речь о небольшой сети, например домашней компьютерной сети, или обо всём Интернете. IP-адрес обеспечивает доставку данных нужному получателю. Мы можем представить адреса `MAC` и `IPv4` / `IPv6` следующим образом:

- `IPv4` / `IPv6` — описывает уникальный почтовый адрес и район, в котором находится здание получателя.
- `MAC` — указывает точный этаж и квартиру получателя.

Один IP-адрес может быть адресован нескольким получателям (широковещательная рассылка), а устройство может отвечать на запросы с нескольких IP-адресов. Однако необходимо убедиться, что каждый IP-адрес назначен только один раз в рамках сети.

---

## Структура IPv4

Наиболее распространённым методом присвоения IP-адресов является `IPv4`, который представляет собой `32`-битное двоичное число, объединённое в `4 bytes`, состоящее из `8`-битных групп (`octets`), в диапазоне от `0-255`. Они преобразуются в более удобные для чтения десятичные числа, разделённые точками и представленные в виде десятичной записи с точками.

Таким образом, IPv4-адрес может выглядеть следующим образом:

|**Обозначение**|**Презентация**|
|---|---|
|Бинарный|0111 1111.0000 0000.0000 0000.0000 0001|
|Десятичная дробь|127.0.0.1|

Каждому сетевому интерфейсу (сетевым картам, сетевым принтерам или маршрутизаторам) присваивается уникальный IP-адрес.

Формат `IPv4` позволяет использовать 4 294 967 296 уникальных адресов. IP-адрес состоит из `host part` и `network part`.`router` присваивает `host part` IP-адреса на локальном уровне или с помощью администратора. Соответствующий `network administrator` присваивает `network part`. В Интернете этим занимается `IANA`, который распределяет уникальные IP-адреса и управляет ими.

В прошлом здесь проводилась дальнейшая классификация. Блоки IP-сетей делились на `classes A - E`. Разные классы различались по длине общих ресурсов хоста и сети.

|**`Class`**|**Сетевой адрес**|**Первый Адрес**|**Последний адрес**|**Маска подсети**|**CIDR**|**Подсети**|**IPs - адреса**|
|---|---|---|---|---|---|---|---|
|`A`|1.0.0.0|1.0.0.1|127.255.255.255|255.0.0.0|/8|127|16,777,214 + 2|
|`B`|128.0.0.0|128.0.0.1|191.255.255.255|255.255.0.0|/16|16,384|65,534 + 2|
|`C`|192.0.0.0|192.0.0.1|223.255.255.255|255.255.255.0|/24|2,097,152|254 + 2|
|`D`|224.0.0.0|224.0.0.1|239.255.255.255|Многоадресная рассылка|Многоадресная рассылка|Многоадресная рассылка|Многоадресная рассылка|
|`E`|240.0.0.0|240.0.0.1|255.255.255.255|зарезервировано|зарезервировано|зарезервировано|зарезервировано|

---

## Маска Подсети

Дальнейшее разделение этих классов на небольшие сети осуществляется с помощью `subnetting`. Это разделение выполняется с помощью `netmasks`, длина которого равна длине IPv4-адреса. Как и в случае с классами, он описывает, какие битовые позиции в IP-адресе действуют как `network part` или `host part`.

|**Класс**|**Сетевой адрес**|**Первый Адрес**|**Последний адрес**|**`Subnetmask`**|**CIDR**|**Подсети**|**IPs - адреса**|
|---|---|---|---|---|---|---|---|
|**A**|1.0.0.0|1.0.0.1|127.255.255.255|`255.0.0.0`|/8|127|16,777,214 + 2|
|**B**|128.0.0.0|128.0.0.1|191.255.255.255|`255.255.0.0`|/16|16,384|65,534 + 2|
|**C**|192.0.0.0|192.0.0.1|223.255.255.255|`255.255.255.0`|/24|2,097,152|254 + 2|
|**D**|224.0.0.0|224.0.0.1|239.255.255.255|`Multicast`|Многоадресная рассылка|Многоадресная рассылка|Многоадресная рассылка|
|**E**|240.0.0.0|240.0.0.1|255.255.255.255|`reserved`|зарезервировано|зарезервировано|зарезервировано|

---

## Адреса сети и шлюза

`two` дополнительные `IPs` адреса, добавленные в `IPs column`, зарезервированы для так называемых `network address` и `broadcast address`. Ещё одну важную роль играет `default gateway`, который является именем IPv4-адреса `router`, объединяющего сети и системы с разными протоколами и управляющего адресами и способами передачи. Обычно `default gateway` присваивается первый или последний доступный IPv4-адрес в подсети. Это не является техническим требованием, но стало стандартом де-факто в сетевых средах любого размера.

|**Класс**|**Сетевой адрес**|**`First Address`**|**Последний адрес**|**Маска подсети**|**CIDR**|**Подсети**|**`IPs`**|
|---|---|---|---|---|---|---|---|
|A|1.0.0.0|`1.0.0.1`|126.255.255.255|255.0.0.0|/8|126|16,777,214 `+ 2`|
|B|128.0.0.0|`128.0.0.1`|191.255.255.255|255.255.0.0|/16|16,384|65,534 `+ 2`|
|C|192.0.0.0|`192.0.0.1`|223.255.255.255|255.255.255.0|/24|2,097,152|254 `+ 2`|
|D|224.0.0.0|`224.0.0.1`|239.255.255.255|Многоадресная рассылка|Многоадресная рассылка|Многоадресная рассылка|Многоадресная рассылка|
|E|240.0.0.0|`240.0.0.1`|255.255.255.255|зарезервировано|зарезервировано|зарезервировано|зарезервировано|

---

## Широковещательный Адрес

Задача `broadcast` IP-адреса — соединять все устройства в сети друг с другом. `Broadcast` в сети — это сообщение, которое передаётся всем участникам сети и не требует ответа. Таким образом, хост отправляет пакет данных всем остальным участникам сети одновременно и при этом сообщает свой `IP address`, по которому получатели могут с ним связаться. Это `last IPv4`-адрес, который используется для `broadcast`.

|**Класс**|**Сетевой адрес**|**Первый Адрес**|**`Last Address`**|**Маска подсети**|**CIDR**|**Подсети**|**IPs - адреса**|
|---|---|---|---|---|---|---|---|
|A|1.0.0.0|1.0.0.1|`127.255.255.255`|255.0.0.0|/8|127|16,777,214 + 2|
|B|128.0.0.0|128.0.0.1|`191.255.255.255`|255.255.0.0|/16|16,384|65,534 + 2|
|C|192.0.0.0|192.0.0.1|`223.255.255.255`|255.255.255.0|/24|2,097,152|254 + 2|
|D|224.0.0.0|224.0.0.1|`239.255.255.255`|Многоадресная рассылка|Многоадресная рассылка|Многоадресная рассылка|Многоадресная рассылка|
|E|240.0.0.0|240.0.0.1|`255.255.255.255`|зарезервировано|зарезервировано|зарезервировано|зарезервировано|

---

## Двоичная система счисления

Двоичная система счисления — это система счисления, в которой используются только два различных состояния, обозначаемые двумя числами (`0` и `1`), в отличие от десятичной системы (от 0 до 9).

Как мы уже видели, IPv4-адрес состоит из 4 октетов. Каждый `octet` состоит из `8 bits`. Каждая позиция бита в октете имеет определённое десятичное значение. Возьмём в качестве примера следующий IPv4-адрес:

- IPv4 - адрес: `192.168.10.39`

Вот пример того, как выглядит `first octet`:

#### 1-й октет — значение: 192

  IP - адреса

```shell-session
Values:         128  64  32  16  8  4  2  1
Binary:           1   1   0   0  0  0  0  0
```

Если мы вычислим сумму всех этих значений для каждого октета, в котором бит установлен в `1`, то получим следующую сумму:

|**Октет**|**Ценности**|**Сумма**|
|---|---|---|
|1 - й|128 + 64 + 0 + 0 + 0 + 0 + 0 + 0|= `192`|
|2 - й|128 + 0 + 32 + 0 + 8 + 0 + 0 + 0|= `168`|
|3 - й|0 + 0 + 0 + 0 + 8 + 0 + 2 + 0|= `10`|
|4 - й|0 + 0 + 32 + 0 + 0 + 4 + 2 + 1|= `39`|

Весь процесс преобразования из двоичной системы в десятичную выглядит следующим образом:

#### IPv4 — двоичная система счисления

  IP - адреса

```shell-session
Octet:             1st         2nd         3rd         4th
Binary:         1100 0000 . 1010 1000 . 0000 1010 . 0010 0111
Decimal:           192    .    168    .     10    .     39
```

- IPv4 - адрес: `192.168.10.39`

Это сложение выполняется для каждого октета, в результате чего получается десятичное представление `IPv4 address`. Маска подсети вычисляется таким же образом.

#### IPv4 — десятичный код в двоичном формате

  IP - адреса

```shell-session
Values:         128  64  32  16  8  4  2  1
Binary:           1   1   1   1  1  1  1  1
```

|**Октет**|**Ценности**|**Сумма**|
|---|---|---|
|1 - й|128 + 64 + 32 + 16 + 8 + 4 + 2 + 1|= `255`|
|2 - й|128 + 64 + 32 + 16 + 8 + 4 + 2 + 1|= `255`|
|3 - й|128 + 64 + 32 + 16 + 8 + 4 + 2 + 1|= `255`|
|4 - й|0 + 0 + 0 + 0 + 0 + 0 + 0 + 0|= `0`|

#### Маска Подсети

  IP - адреса

```shell-session
Octet:             1st         2nd         3rd         4th
Binary:         1111 1111 . 1111 1111 . 1111 1111 . 0000 0000
Decimal:           255    .    255    .    255    .     0
```

- IPv4 - адрес: `192.168.10.39`
    
- Маска подсети: `255.255.255.0`
    

---

## CIDR

`Classless Inter-Domain Routing` (`CIDR`) — это способ представления, который заменяет фиксированное соответствие между IPv4-адресом и классами сетей (A, B, C, D, E). Разделение основано на маске подсети или так называемом `CIDR suffix`, который позволяет побитово разделять адресное пространство IPv4 и, таким образом, создавать `subnets` любого размера.`CIDR suffix` указывает, сколько битов от начала IPv4-адреса принадлежит сети. Это обозначение, которое представляет `subnet mask` путём указания количества `1`-битов в маске подсети.

В качестве примера рассмотрим следующий IPv4-адрес и маску подсети:

- IPv4 - адрес: `192.168.10.39`
    
- Маска подсети: `255.255.255.0`
    

Теперь полное представление IPv4-адреса и маски подсети будет выглядеть следующим образом:

- CIDR: `192.168.10.39/24`

Таким образом, суффикс CIDR представляет собой сумму всех единиц в маске подсети.

  IP - адреса

```shell-session
Octet:             1st         2nd         3rd         4th
Binary:         1111 1111 . 1111 1111 . 1111 1111 . 0000 0000 (/24)
Decimal:           255    .    255    .    255    .     0
```
