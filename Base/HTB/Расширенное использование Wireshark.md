#traffic #network #htb #wireshark 

В этом разделе мы рассмотрим расширенные возможности использования Wireshark. Разработчики проекта включили в него множество различных функций: от отслеживания TCP-соединений до взлома учётных данных для беспроводных сетей. Благодаря множеству различных плагинов Wireshark является одним из лучших инструментов для анализа трафика.

---

## Плагины

Вкладки «Анализ» и «Статистика» предоставляют множество плагинов для работы с захваченными данными. В этом разделе мы рассмотрим некоторые из них. Мы бы рассказали обо всех возможностях Wireshark, но, к сожалению, это просто невозможно сделать в рамках вводного модуля. Я призываю всех экспериментировать и пробовать что-то новое в процессе обучения.

#### Вкладки «Статистика» и «Анализ»

Вкладки «Статистика» и «Анализ» могут предоставить нам ценную информацию об изучаемых данных. На этих этапах мы можем использовать множество встроенных плагинов, которые предлагает Wireshark.

Эти плагины могут предоставить нам подробные отчёты об используемом сетевом трафике. Они могут показать нам всё: от самых активных пользователей в нашей среде до конкретных разговоров и даже разбивку по IP-адресам и протоколам.

#### Вкладка "Статистика "

![[Pasted image 20250907180154.png]]

#### Анализ

На вкладке «Анализ» мы можем использовать плагины, которые позволяют отслеживать TCP-потоки, фильтровать типы соединений, создавать новые фильтры пакетов и просматривать экспертную информацию о трафике, которую генерирует Wireshark. Ниже приведено несколько примеров использования этих плагинов.

#### Вкладка " Анализ"

![[Pasted image 20250907180159.png]]

#### Следовать за потоками TCP

Wireshark может объединять TCP-пакеты, чтобы воссоздать весь поток в читаемом формате. Эта функция также позволяет извлекать данные (`images, files, etc.`) из захвата. Это работает практически с любым протоколом, использующим TCP в качестве транспортного механизма.

Чтобы использовать эту функцию:

- Щёлкните правой кнопкой мыши по пакету из потока, который мы хотим воссоздать.
- выберите следовать → TCP
- Откроется новое окно с восстановленным потоком. Отсюда мы можем просмотреть весь разговор.

#### Следите за потоком с помощью графического интерфейса

![[follow-tcp.gif]]

Кроме того, мы можем использовать фильтр `tcp.stream eq #` для поиска и отслеживания разговоров, записанных в файле pcap.

## Фильтр для определённого TCP-потока

![[Pasted image 20250907180219.png]]

Обратите внимание, что первые три пакета на изображении выше содержат полное TCP-рукопожатие. После этих пакетов мы видим поток передаваемых данных. Мы убрали из поля зрения всё, что не относится к делу, с помощью фильтра и теперь можем видеть диалог по порядку.

#### Извлечение данных и файлов из захвата

Wireshark может восстанавливать различные типы данных из потоков. Для этого необходимо записать весь разговор. В противном случае эта функция не сможет собрать воедино неполную дейтаграмму. Если вы хотите подробнее узнать о том, как работает эта функция, изучите модуль «Основы сетевых технологий» или изучите фрагментацию TCP/IP.

Чтобы извлечь файлы из потока:

- остановите свой захват.
- Выберите «Файл» → «Экспорт» → , затем выберите формат протокола для извлечения данных.
- (DICOM, HTTP, SMB и т. д.)

#### Извлечение файлов из графического интерфейса пользователя

![[extract-http.gif]]

Ещё один интересный способ извлечения данных из файла pcap — использование FTP. Протокол передачи файлов перемещает данные между сервером и хостом, извлекая их из необработанных байтов и восстанавливая файл. (изображение, текстовые документы и т. д.) FTP использует TCP в качестве транспортного протокола и задействует порты `20 & 21` для работы. Порт TCP 20 используется для передачи данных между сервером и хостом, а порт 21 — в качестве управляющего порта FTP. Все команды, такие как вход в систему, просмотр списка файлов, загрузка или выгрузка, выполняются через этот порт. Для этого нам нужно изучить различные `FTP` фильтры отображения в Wireshark. Полный список можно найти [здесь](https://www.wireshark.org/docs/dfref/f/ftp.html). Сейчас мы рассмотрим три из них:

- `ftp` — Отобразит любую информацию о протоколе FTP.
    - Мы можем использовать это, чтобы понять, какие хосты/серверы передают данные по FTP.

#### FTP - Дисектор

![[Pasted image 20250907180239.png]]

- `ftp.request.command` — Отображает все команды, отправленные по каналу управления FTP (порт 21)
    - С помощью этого фильтра мы можем искать такую информацию, как имена пользователей и пароли. Он также может показывать нам имена файлов для любых запросов.

#### Фильтр команд FTP-запросов

![[Pasted image 20250907180245.png]]

- `ftp-data` — Отображает все данные, передаваемые по каналу передачи данных (порт 20)
    - Если мы отфильтруем переписку и воспользуемся `ftp-data`, то сможем сохранить все, что было отправлено в ходе переписки. Мы можем восстановить все, что было передано, поместив необработанные данные в новый файл и присвоив ему соответствующее имя.

#### FTP-Фильтр данных

![[Pasted image 20250907180250.png]]

Поскольку FTP использует TCP в качестве транспортного механизма, мы можем применить функцию `follow tcp stream`, которую использовали ранее в этом разделе, чтобы сгруппировать любой диалог, который мы хотим изучить. Основные этапы анализа данных FTP из файла pcap:

1. Определите любой FTP-трафик с помощью фильтра отображения `ftp` .
2. Посмотрите на команды управления, передаваемые между сервером и хостами, чтобы определить, была ли выполнена какая-либо передача данных и кто это сделал, с помощью фильтра `ftp.request.command` .
3. Выберите файл, затем выполните фильтрацию по `ftp-data`. Выберите пакет, соответствующий интересующему нас файлу, и проследите за соответствующим ему потоком TCP.
4. После этого замените "`Show and save data as`" на "`Raw`" и сохраните содержимое под исходным именем файла.
5. Подтвердите извлечение, проверив тип файла.