#network #htb 

У многих людей разные представления о том, что такое прокси-сервер:

- Специалисты по безопасности переходят на `HTTP Proxies` (BurpSuite) или меняют направление с помощью `SOCKS/SSH Proxy` (`Chisel`, `ptunnel`, `sshuttle`).
    
- Веб-разработчики используют прокси-серверы, такие как Cloudflare или ModSecurity, для блокировки вредоносного трафика.
    
- Обычные люди могут подумать, что прокси-сервер используется для сокрытия вашего местоположения и доступа к каталогу Netflix в другой стране.
    
- Правоохранительные органы часто связывают прокси-серверы с незаконной деятельностью.
    

Не все приведённые выше примеры верны. Прокси-сервер — это устройство или служба, которые находятся в середине соединения и выступают в роли посредника. Ключевой информацией является `mediator`, поскольку это означает, что устройство, находящееся в середине соединения, должно иметь возможность проверять содержимое трафика. Без возможности быть `mediator` устройство технически является `gateway`, а не прокси-сервером.

Возвращаясь к вопросу выше, можно сказать, что у среднестатистического человека сложилось ошибочное представление о том, что такое прокси-сервер, поскольку он, скорее всего, использует VPN для сокрытия своего местоположения, что технически не является прокси-сервером. Большинство людей думают, что всякий раз, когда меняется IP-адрес, это прокси-сервер, и в большинстве случаев лучше их не поправлять, так как это распространённое и безобидное заблуждение. Попытка их поправить может привести к более длительному разговору о табуляции и пробелах, `emacs` и `vim` или к выяснению того, что они являются `nano` пользователями.

Если вам сложно это запомнить, то прокси-серверы почти всегда работают на седьмом уровне модели OSI. Существует множество типов прокси-сервисов, но основными являются следующие:

- `Dedicated Proxy` / `Forward Proxy`
- `Reverse Proxy`
- `Transparent Proxy`

---

## Выделенный Прокси-сервер / Прямой Прокси-сервер

`Forward Proxy` — это то, что большинство людей представляют себе под словом «прокси». Прямой прокси — это когда клиент отправляет запрос на компьютер, а тот выполняет этот запрос.

Например, в корпоративной сети компьютеры с конфиденциальной информацией могут не иметь прямого доступа к Интернету. Чтобы получить доступ к веб-сайту, они должны пройти через прокси-сервер (или веб-фильтр). Это может стать невероятно эффективной защитой от вредоносного ПО, поскольку ему нужно не только обойти веб-фильтр (что несложно), но и `proxy aware` или использовать нетрадиционный командный сервер (способ получения вредоносной программой информации о задачах). Если организация использует только `FireFox`, вероятность заражения вредоносным ПО, использующим прокси-сервер, крайне мала.

Веб-браузеры, такие как Internet Explorer, Edge или Chrome, по умолчанию используют настройки «Системный прокси». Если вредоносное ПО использует WinSock (встроенный API Windows), оно, скорее всего, будет поддерживать прокси без дополнительного кода. Firefox не использует `WinSock` и вместо этого использует `libcurl`, что позволяет ему использовать один и тот же код в любой операционной системе. Это означает, что вредоносное ПО должно искать Firefox и получать настройки прокси, что маловероятно.

В качестве альтернативы вредоносное ПО может использовать DNS в качестве командно-контрольного механизма, но если организация отслеживает DNS (что легко сделать с помощью [Sysmon](https://medium.com/falconforce/sysmon-11-dns-improvements-and-filedelete-events-7a74f17ca842)), то такой тип трафика будет быстро обнаружен.

Другим примером прямого прокси-сервера является Burp Suite, поскольку большинство людей используют его для переадресации HTTP-запросов. Однако это приложение — универсальный инструмент среди HTTP-прокси, и его можно настроить как обратный прокси-сервер или сделать прозрачным!

#### Прямой Прокси-сервер

![[Pasted image 20250907175017.png]]

---

## Обратный Прокси-сервер

Как вы, возможно, догадались, `reverse proxy` — это противоположность `Forward Proxy`. Вместо того чтобы фильтровать исходящие запросы, он фильтрует входящие. Чаще всего `Reverse Proxy` используется для прослушивания адреса и перенаправления его в закрытую сеть.

Многие организации используют CloudFlare, поскольку у них есть надёжная сеть, способная противостоять большинству DDOS-атак. С помощью Cloudflare организации могут фильтровать объём (и тип) трафика, отправляемого на их веб-серверы.

Тестировщики на проникновение настраивают обратные прокси-серверы на зараженных конечных точках. Зараженная конечная точка прослушивает порт и перенаправляет все клиентские подключения к этому порту обратно злоумышленнику через зараженную конечную точку. Это полезно для обхода брандмауэров или уклонения от регистрации. В организациях могут быть `IDS` (`Intrusion Detection Systems`), отслеживающие внешние веб-запросы. Если злоумышленник получает доступ к организации через SSH, обратный прокси-сервер может отправлять веб-запросы через SSH-туннель и обходить систему обнаружения вторжений.

Другим распространённым обратным прокси-сервером является `ModSecurity`, а `Web Application Firewall` (`WAF`). Брандмауэры веб-приложений проверяют веб-запросы на наличие вредоносного контента и блокируют их, если запрос вредоносный. Если вы хотите узнать об этом больше, рекомендуем ознакомиться с [базовым набором правил ModSecurity](https://owasp.org/www-project-modsecurity-core-rule-set/), так как это отличная отправная точка. Cloudflare также может выступать в роли брандмауэра веб-приложений, но для этого необходимо разрешить им расшифровывать HTTPS-трафик, что может не понравиться некоторым организациям.

#### Обратный Прокси-сервер

![[Pasted image 20250907175023.png]]

---

## (Не) Прозрачный Прокси-сервер

Все эти прокси-сервисы работают либо как `transparently`, либо как `non-transparently`.

При использовании `transparent proxy` клиент не знает о его существовании. Прозрачный прокси-сервер перехватывает запросы клиента к Интернету и выступает в качестве замещающего сервера. Для внешнего мира прозрачный прокси-сервер, как и непрозрачный, выступает в качестве партнёра по коммуникации.

Если это `non-transparent proxy`, мы должны быть проинформированы о его существовании. Для этого нам и программному обеспечению, которое мы хотим использовать, предоставляется специальная конфигурация прокси-сервера, которая обеспечивает перенаправление трафика в Интернет через прокси-сервер. Если такой конфигурации нет, мы не сможем подключиться через прокси-сервер. Однако, поскольку прокси-сервер обычно обеспечивает единственный путь для подключения к другим сетям, подключение к Интернету обычно прерывается без соответствующей конфигурации прокси-сервера.