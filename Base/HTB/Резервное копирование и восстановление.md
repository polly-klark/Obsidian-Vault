#htb #linux 

Системы Linux предоставляют ряд мощных инструментов для резервного копирования и восстановления данных, которые отличаются эффективностью и безопасностью. Эти инструменты помогают обеспечить не только защиту данных от потери или повреждения, но и их быстрый доступ в нужный момент.

При резервном копировании данных в системе Ubuntu у нас есть несколько вариантов, в том числе:

- Rsync
- Deja Dup
- Duplicity

Rsync — это инструмент с открытым исходным кодом, который позволяет быстро и безопасно создавать резервные копии как локально, так и в удалённом месте. Одно из его ключевых преимуществ заключается в том, что он передаёт только изменённые части файлов, что делает его очень эффективным при работе с большими объёмами данных. Rsync особенно полезен для сетевых передач, таких как синхронизация файлов между серверами или создание инкрементных резервных копий через Интернет.

Duplicity — ещё один мощный инструмент, основанный на Rsync, но с дополнительными функциями шифрования для защиты резервных копий. Он позволяет шифровать резервные копии, обеспечивая безопасность конфиденциальных данных даже при их хранении на удалённых серверах, FTP-сайтах или в облачных сервисах, таких как Amazon S3. Duplicity обеспечивает дополнительный уровень безопасности, сохраняя при этом эффективность передачи данных с помощью Rsync.

Представьте, что ваши данные — это ценные сокровища, хранящиеся в доме. Инструменты резервного копирования в Linux, такие как Rsync, Duplicity и Deja Dup, работают как разные виды сейфов. Rsync — это быстрый транспорт, который перевозит только то, что было изменено или добавлено, что делает его идеальным способом отправки обновлений в удалённое хранилище. Duplicity — это сейф с высоким уровнем безопасности, который не только хранит сокровища, но и запирает их сложным кодом, гарантируя, что никто другой не сможет получить к ним доступ. Deja Dup — это простой и доступный сейф, которым может управлять любой, при этом обеспечивая такой же уровень защиты. Шифрование резервных копий добавляет дополнительный замок на ваш сейф, гарантируя, что даже если кто-то его найдёт, он не сможет попасть внутрь.

Для пользователей, которые предпочитают более простой и удобный вариант, Deja Dup предлагает графический интерфейс, упрощающий процесс резервного копирования. В качестве основы он также использует Rsync и, как и Duplicity, поддерживает зашифрованные резервные копии. Deja Dup идеально подходит для пользователей, которым нужен быстрый и простой доступ к функциям резервного копирования и восстановления без необходимости погружаться в командную строку.

Обеспечение безопасности резервных копий так же важно, как и их создание. Шифрование резервных копий помогает защитить их от несанкционированного доступа и даёт уверенность в том, что конфиденциальная информация останется в безопасности. В системах Ubuntu вы можете использовать дополнительные инструменты шифрования, такие как GnuPG, eCryptfs или LUKS, чтобы добавить ещё один уровень защиты для ваших резервных копий.

Резервное копирование и восстановление данных — важная процедура для всех, кто работает с Ubuntu. Используя такие инструменты, как Rsync, Duplicity и Deja Dup, вы можете быть уверены, что ваши данные надёжно хранятся и их можно легко восстановить в случае непредвиденной потери.

Чтобы установить Rsync в Ubuntu, мы можем воспользоваться менеджером пакетов `apt`:

#### Установить Rsync

  Резервное копирование и восстановление

```shell-session
Barlogsha@htb[/htb]$ sudo apt install rsync -y
```

Это позволит установить последнюю версию Rsync в системе. После завершения установки мы можем начать использовать этот инструмент для резервного копирования и восстановления данных. Чтобы создать резервную копию всего каталога с помощью `rsync`, мы можем использовать следующую команду:

#### Rsync - Резервное копирование локального каталога на наш Резервный сервер

  Резервное копирование и восстановление

```shell-session
Barlogsha@htb[/htb]$ rsync -av /path/to/mydirectory user@backup_server:/path/to/backup/directory
```

Эта команда скопирует весь каталог (`/path/to/mydirectory`) на удалённый хост (`backup_server`), в каталог `/path/to/backup/directory`. Опция `archive` (`-a`) используется для сохранения исходных атрибутов файла, таких как права доступа, временные метки и т. д., а опция `verbose` (`-v`) обеспечивает подробный вывод о ходе выполнения операции `rsync`

Мы также можем добавить дополнительные параметры для настройки процесса резервного копирования, например, использовать сжатие и инкрементное резервное копирование. Это можно сделать следующим образом:

  Резервное копирование и восстановление

```shell-session
Barlogsha@htb[/htb]$ rsync -avz --backup --backup-dir=/path/to/backup/folder --delete /path/to/mydirectory user@backup_server:/path/to/backup/directory
```

При этом мы создаем резервную копию `mydirectory` на удаленное устройство `backup_server`, сохраняя исходные атрибуты файла, временные метки и разрешения, а также включаем сжатие (`-z`) для более быстрой передачи. `--backup`Опция создает инкрементные резервные копии в каталоге `/path/to/backup/folder`, а `--delete` опция удаляет файлы с удаленного хоста, которых больше нет в исходном каталоге.

Если мы хотим восстановить наш каталог с резервного сервера в локальный каталог, мы можем использовать следующую команду:

#### Rsync - Восстановите нашу резервную копию

  Резервное копирование и восстановление

```shell-session
Barlogsha@htb[/htb]$ rsync -av user@remote_host:/path/to/backup/directory /path/to/mydirectory
```

---

## Зашифрованный Rsync

Чтобы обеспечить безопасность передачи файлов `rsync` между нашим локальным хостом и резервным сервером, мы можем использовать SSH и другие меры безопасности. С помощью SSH мы можем шифровать передаваемые данные, что значительно усложняет доступ к ним для посторонних лиц. Кроме того, мы можем использовать брандмауэры и другие протоколы безопасности, чтобы обеспечить сохранность наших данных во время передачи. Приняв эти меры, мы можем быть уверены, что наши данные защищены, а передача файлов безопасна. Поэтому мы советуем `rsync` использовать SSH следующим образом:

#### Безопасная передача нашей резервной копии

  Резервное копирование и восстановление

```shell-session
Barlogsha@htb[/htb]$ rsync -avz -e ssh /path/to/mydirectory user@backup_server:/path/to/backup/directory
```

Передача данных между нашим локальным хостом и резервным сервером происходит по зашифрованному SSH-соединению, которое обеспечивает конфиденциальность и целостность передаваемых данных. Этот процесс шифрования гарантирует, что данные защищены от потенциальных злоумышленников, которые в противном случае могли бы получить доступ к данным и изменить их без разрешения. Сам ключ шифрования также защищён комплексным набором протоколов безопасности, что ещё больше затрудняет несанкционированный доступ к данным. Кроме того, зашифрованное соединение отличается высокой устойчивостью к любым попыткам взлома, что позволяет нам быть уверенными в защите передаваемых данных.

---

## Автоматическая синхронизация

Чтобы включить автоматическую синхронизацию с помощью `rsync`, вы можете использовать комбинацию `cron` и `rsync` для автоматизации процесса синхронизации. Запланировав выполнение задания cron через регулярные промежутки времени, вы обеспечите синхронизацию содержимого двух систем. Это может быть особенно полезно для организаций, которым необходимо синхронизировать данные на нескольких компьютерах. Кроме того, настройка автоматической синхронизации с помощью `rsync` может значительно сэкономить время и силы, поскольку устраняет необходимость в ручной синхронизации. Это также помогает поддерживать актуальность и согласованность файлов и данных, хранящихся в системах, что снижает количество ошибок и повышает эффективность.

Поэтому мы создаём новый скрипт под названием `RSYNC_Backup.sh`, который будет запускать команду `rsync` для синхронизации нашего локального каталога с удалённым. Однако, поскольку мы используем скрипт для подключения rsync по SSH, нам нужно настроить аутентификацию на основе ключей. Это позволит избежать необходимости вводить пароль при подключении по SSH.

Сначала мы генерируем пару ключей для нашего пользователя.

  Резервное копирование и восстановление

```shell-session

Barlogsha@htb[/htb]$ ssh-keygen -t rsa -b 2048

```

Следуйте подсказкам, чтобы указать местоположение (по умолчанию используется `~/.ssh/id_rsa`), и при необходимости введите кодовую фразу (оставьте поле пустым, если кодовая фраза не нужна). Затем нам нужно скопировать наш открытый ключ на удалённый сервер.

  Резервное копирование и восстановление

```shell-session

Barlogsha@htb[/htb]$ ssh-copy-id user@backup_server

```

Теперь мы можем создать наш скрипт для автоматизации резервного копирования rsync.

#### RSYNC_Backup.sh

Код: bash

```bash
#!/bin/bash

rsync -avz -e ssh /path/to/mydirectory user@backup_server:/path/to/backup/directory
```

Затем, чтобы обеспечить корректную работу скрипта, мы должны предоставить необходимые разрешения. Кроме того, важно убедиться, что владельцем скрипта является нужный пользователь, так как это гарантирует, что только нужный пользователь будет иметь доступ к скрипту и что другой пользователь не сможет его изменить.

  Резервное копирование и восстановление

```shell-session
Barlogsha@htb[/htb]$ chmod +x RSYNC_Backup.sh
```

После этого мы можем создать таблицу cron, которая будет запускать скрипт `cron` каждый час в 0-ю минуту.

  Резервное копирование и восстановление

```shell-session

Barlogsha@htb[/htb]$ cronjob -e

```

Мы можем настроить время в соответствии с нашими потребностями. Для этого в crontab должно быть следующее содержимое:

#### Автоматическая синхронизация - Crontab

  Резервное копирование и восстановление

```shell-session
0 * * * * /path/to/RSYNC_Backup.sh
```

При такой настройке `cron` будет отвечать за выполнение скрипта с заданным интервалом, обеспечивая выполнение команды `rsync` и синхронизацию содержимого локального каталога с удалённым хостом.

Мы рекомендуем вам попробовать rsync с помощью Pwnbox. Вместо синхронизации файлов с удалённым сервером вы можете использовать Pwnbox и как источник, и как место назначения, что упрощает тестирование. Для этого создайте на Pwnbox два каталога:

1. `to_backup` (где хранятся ваши исходные данные) и другой вызываемый
2. `synced_backup` (куда будут скопированы синхронизированные данные)

Затем вы перенесёте данные из каталога `to_backup` в каталог `synced_backup` с помощью `rsync`. Чтобы автоматизировать этот процесс, настройте задание `cron` для выполнения каждую минуту, чтобы обеспечить непрерывную синхронизацию. Помните, что, поскольку мы тестируем это локально, мы можем использовать петлевой IP-адрес 127.0.0.1 в качестве адреса «удаленного» хоста.