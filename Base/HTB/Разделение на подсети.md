#network #htb 

Разделение диапазона адресов IPv4 на несколько более мелких диапазонов называется `subnetting`.

Подсеть — это логический сегмент сети, в котором используются IP-адреса с одним и тем же сетевым адресом. Подсеть можно представить как обозначенный вход в большой коридор здания. Например, это может быть стеклянная дверь, разделяющая различные отделы здания компании. С помощью подсетей мы можем самостоятельно создать определённую подсеть или узнать следующую информацию о соответствующей сети:

- `Network address`
- `Broadcast address`
- `First host`
- `Last host`
- `Number of hosts`

Возьмём в качестве примера следующий IPv4-адрес и маску подсети:

- IPv4 - адрес: `192.168.12.160`
- Маска Подсети: `255.255.255.192`
- CIDR: `192.168.12.160/26`

---

Мы уже знаем, что IP-адрес состоит из `network part` и `host part`.

#### Сетевая часть

|**Подробности о**|**1 - й Октет**|**2 - й Октет**|**3 - й Октет**|**4 - й Октет**|**Десятичная дробь**|
|---|---|---|---|---|---|
|IPv4|`1100 0000`|`1010 1000`|`0000 1100`|`10`10 0000|192.168.12.160`/26`|
|Маска подсети|`1111 1111`|`1111 1111`|`1111 1111`|`11`00 0000|`255.255.255.192`|
|Биты|/8|/16|/24|/32||

При разбиении на подсети мы используем маску подсети в качестве шаблона для IPv4-адреса. По `1`-битам в маске подсети мы определяем, какие биты в IPv4-адресе `cannot` нужно изменить. Это `fixed`-биты, которые определяют «основную сеть», в которой находится подсеть.

#### Принимающая часть

|**Подробности о**|**1 - й Октет**|**2 - й Октет**|**3 - й Октет**|**4 - й Октет**|**Десятичная дробь**|
|---|---|---|---|---|---|
|IPv4|1100 0000|1010 1000|0000 1100|10`10 0000`|192.168.12.160/26|
|Маска подсети|1111 1111|1111 1111|1111 1111|11`00 0000`|255.255.255.192|
|Биты|/8|/16|/24|/32||

Биты в `host part` можно заменить на адреса `first` и `last`. Первый адрес — это `network address`, а последний адрес — это `broadcast address` для соответствующей подсети.

`network address` необходим для доставки пакета данных. Если `network address` одинаков для исходного и конечного адресов, пакет данных доставляется в пределах одной подсети. Если сетевые адреса различаются, пакет данных должен быть перенаправлен в другую подсеть через `default gateway`.

`subnet mask` определяет, где происходит это разделение.

#### Разделение сетевой и хост-частей

|**Подробности о**|**1 - й Октет**|**2 - й Октет**|**3 - й Октет**|**4 - й Октет**|**Десятичная дробь**|
|---|---|---|---|---|---|
|IPv4|1100 0000|1010 1000|0000 1100|10`\|`10 0000|192.168.12.160/26|
|Маска подсети|`1111 1111`|`1111 1111`|`1111 1111`|`11\|`00 0000|255.255.255.192|
|Биты|/8|/16|/24|/32||

---

#### Сетевой адрес

Итак, если мы установим все биты в `0` в `host part` IPv4-адреса, то получим `network address` соответствующей подсети.

|**Подробности о**|**1 - й Октет**|**2 - й Октет**|**3 - й Октет**|**4 - й Октет**|**Десятичная дробь**|
|---|---|---|---|---|---|
|IPv4|1100 0000|1010 1000|0000 1100|10`\|00 0000`|`192.168.12.128`/26|
|Маска подсети|`1111 1111`|`1111 1111`|`1111 1111`|`11\|`00 0000|255.255.255.192|
|Биты|/8|/16|/24|/32||

---

#### Широковещательный Адрес

Если мы установим все биты в `host part` IPv4-адреса в значение `1`, то получим `broadcast address`.

|**Подробности о**|**1 - й Октет**|**2 - й Октет**|**3 - й Октет**|**4 - й Октет**|**Десятичная дробь**|
|---|---|---|---|---|---|
|IPv4|1100 0000|1010 1000|0000 1100|10`\|11 1111`|`192.168.12.191`/26|
|Маска подсети|`1111 1111`|`1111 1111`|`1111 1111`|`11\|`00 0000|255.255.255.192|
|Биты|/8|/16|/24|/32||

Теперь, когда мы знаем, что назначены IPv4-адреса `192.168.12.128` и `192.168.12.191`, все остальные IPv4-адреса находятся в диапазоне от `192.168.12.129-190`. Теперь мы знаем, что в этой подсети всего `64 - 2` (сетевой адрес и широковещательный адрес) или `62` IPv4-адресов, которые мы можем назначить нашим хостам.

| **Хозяева**             | **IPv4**         |
| ----------------------- | ---------------- |
| Сетевой адрес           | `192.168.12.128` |
| Первый Хост             | `192.168.12.129` |
| Другие Хосты            | `...`            |
| Последний Хост          | `192.168.12.190` |
| Широковещательный Адрес | `192.168.12.191` |

---

## Разделение на более мелкие сети

Теперь предположим, что перед нами, администраторами, стоит задача разделить выделенную нам подсеть на 4 дополнительные подсети. Таким образом, важно знать, что мы можем разделять подсети только на основе двоичной системы.

|**Показатель степени**|**Значение**|
|---|---|
|2`^0`|= 1|
|2`^1`|= 2|
|2`^2`|= 4|
|2`^3`|= 8|
|2`^4`|= 16|
|2`^5`|= 32|
|2`^6`|= 64|
|2`^7`|= 128|
|2`^8`|= 256|

---

Таким образом, мы можем разделить `64 hosts` на `4`.`4` равен показателю степени 2`^2` в двоичной системе счисления, поэтому мы определяем количество битов в маске подсети, на которое её нужно расширить. Таким образом, мы знаем следующие параметры:

- Подсеть: `192.168.12.128/26`
- Необходимые Подсети: `4`

Теперь мы увеличиваем/расширяем нашу маску подсети на `2 bits` с `/26` до `/28`, и она выглядит так:

|**Подробности о**|**1 - й Октет**|**2 - й Октет**|**3 - й Октет**|**4 - й Октет**|**Десятичная дробь**|
|---|---|---|---|---|---|
|IPv4|1100 0000|1010 1000|0000 1100|1000`\|` 0000|192.168.12.128`/28`|
|Маска подсети|`1111 1111`|`1111 1111`|`1111 1111`|`1111\|` 0000|`255.255.255.240`|
|Биты|/8|/16|/24|/32||

Далее мы можем разделить `64` доступных нам IPv4-адресов на `4 parts`:

|**Хозяева**|**Математика**|**Подсети**|**Диапазон хостов для каждой подсети**|
|---|---|---|---|
|64|/|4|= `16`|

Итак, мы знаем, насколько большой будет каждая подсеть. Теперь мы начинаем с предоставленного нам сетевого адреса (192.168.12.128) и добавляем `16` хостов `4` раз:

|**Номер подсети.**|**Сетевой адрес**|**Первый Хозяин**|**Последний Хозяин**|**Широковещательный Адрес**|**CIDR**|
|---|---|---|---|---|---|
|1|`192.168.12.128`|192.168.12.129|192.168.12.142|`192.168.12.143`|192.168.12.128/28|
|2|`192.168.12.144`|192.168.12.145|192.168.12.158|`192.168.12.159`|192.168.12.144/28|
|3|`192.168.12.160`|192.168.12.161|192.168.12.174|`192.168.12.175`|192.168.12.160/28|
|4|`192.168.12.176`|192.168.12.177|192.168.12.190|`192.168.12.191`|192.168.12.176/28|

---

## Ментальное Подсетирование

Может показаться, что при разбиении на подсети нужно много считать, но каждый октет повторяется, и всё делится на два, так что запоминать ничего не придётся. Первое, что нужно сделать, — определить, какой октет меняется.

|**1 - й Октет**|**2 - й Октет**|**3 - й Октет**|**4 - й Октет**|
|---|---|---|---|
|/8|/16|/24|/32|

Запомнив эти четыре числа, можно определить, какой октет IP-адреса может измениться. Учитывая сетевой адрес: `192.168.1.1/25`, сразу становится ясно, что 192.168.2.4 не будет находиться в той же сети, потому что в подсети `/25` может измениться только четвёртый октет.

В следующей части определяется, насколько большой может быть каждая подсеть, но путем деления восьми на сеть и рассмотрения `remainder`. Это также называется `Modulo Operation (%)` и широко используется в криптологии. Учитывая наш предыдущий пример с `/25`, `(25 % 8)` было бы 1. Это потому, что восемь трижды превращается в 25 (8 * 3 = 24). Остается 1, который является сетевым битом, зарезервированным для сетевой маски. В каждом октете IP-адреса всего восемь битов. Если для сетевой маски используется единица, уравнение принимает вид 2^(8-1) или 2^7, 128. В таблице ниже приведены все числа.

|**Остаток**|**Число**|**Экспоненциальная форма**|**Форма деления**|
|---|---|---|---|
|0|256|2^8|256|
|1|128|2^7|256/2|
|2|64|2^6|256/2/2|
|3|32|2^5|256/2/2/2|
|4|16|2^4|256/2/2/2/2|
|5|8|2^3|256/2/2/2/2/2|
|6|4|2^2|256/2/2/2/2/2/2|
|7|2|2^1|256/2/2/2/2/2/2/2|

Если запомнить степени двойки до восьми, то вычисления можно будет выполнять мгновенно. Однако, если вы забудете, быстрее будет вспомнить, что 256 нужно разделить пополам столько раз, сколько получится в остатке.

Сложность заключается в том, чтобы получить фактический диапазон IP-адресов, поскольку 0 — это число, а не null в сетевых технологиях. Таким образом, в нашем `/25` со 128 IP-адресами первый диапазон — `192.168.1.0-127`. Первый адрес — это адрес сети, а последний — широковещательный адрес, то есть используемое пространство IP-адресов будет составлять `192.168.1.1-126`. Если бы наш IP-адрес был выше 128, то `usable ip space` было бы равно 192.168.1.129-254 (128 — это сеть, а 255 — широковещательный адрес).