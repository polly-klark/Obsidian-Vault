#network #htb 

Интернет-протоколы — это стандартизированные правила и рекомендации, изложенные в RFC, которые определяют, как устройства в сети должны взаимодействовать друг с другом. Они обеспечивают согласованный и надёжный обмен информацией между устройствами в сети, независимо от используемого аппаратного и программного обеспечения. Для взаимодействия устройств в сети они должны быть подключены через канал связи, например проводное или беспроводное соединение. Затем устройства обмениваются информацией с помощью набора стандартизированных протоколов, которые определяют формат и структуру передаваемых данных. В сетях используются два основных типа соединений: [протокол управления передачей](https://en.wikipedia.org/wiki/Transmission_Control_Protocol) (`TCP`) и [протокол пользовательских дейтаграмм](https://en.wikipedia.org/wiki/User_Datagram_Protocol) (`UDP`).

Нам нужно разобраться в различных и наиболее часто используемых протоколах. Как мы уже знаем, эти протоколы являются основой для всех видов связи между нашими устройствами и компьютерами в сетях. Ниже мы приводим список многих из этих протоколов, с которыми мы будем работать в рамках модулей. Чем лучше мы их понимаем, тем эффективнее можем с ними работать.

---

## Протокол управления передачей

`TCP` Это `connection-oriented` протокол, который устанавливает виртуальное соединение между двумя устройствами перед передачей данных с помощью [трёхстороннего рукопожатия](https://en.wikipedia.org/wiki/Transmission_Control_Protocol#Connection_establishment). Это соединение поддерживается до завершения передачи данных, и устройства могут продолжать обмениваться данными, пока соединение активно.

Например, когда мы вводим URL-адрес в веб-браузере, браузер отправляет HTTP-запрос на сервер, на котором размещен веб-сайт, с помощью `TCP`. Сервер в ответ отправляет браузеру HTML-код веб-сайта с помощью `TCP`. Затем браузер использует этот код для отображения веб-сайта на экране. Этот процесс зависит от `TCP` соединения, которое устанавливается между браузером и веб-сервером и поддерживается до завершения передачи данных. Таким образом, `TCP` является надежным, но более медленным протоколом, чем UDP, поскольку требует дополнительных затрат на установление и поддержание соединения.

|**Протокол**|**Аббревиатура**|**Портвейн**|**Описание**|
|---|---|---|---|
|Telnet|`Telnet`|`23`|Служба удаленного входа в систему|
|Безопасная Оболочка|`SSH`|`22`|Служба безопасного удаленного входа в систему|
|Простой Протокол сетевого управления|`SNMP`|`161-162`|Управление сетевыми устройствами|
|Протокол передачи гипертекста|`HTTP`|`80`|Используется для переноса веб-страниц|
|Безопасный Протокол передачи гипертекста|`HTTPS`|`443`|Используется для передачи защищенных веб-страниц|
|Система Доменных имен|`DNS`|`53`|Поиск доменных имен|
|Протокол Передачи файлов|`FTP`|`20-21`|Используется для передачи файлов|
|Тривиальный протокол передачи файлов|`TFTP`|`69`|Используется для передачи файлов|
|Протокол сетевого времени|`NTP`|`123`|Синхронизация компьютерных часов|
|Простой Протокол передачи почты|`SMTP`|`25`|Используется для передачи электронной почты|
|Протокол Почтового отделения|`POP3`|`110`|Используется для получения электронных писем|
|Протокол доступа к Интернет-сообщениям|`IMAP`|`143`|Используется для доступа к электронной почте|
|Блок Сообщений сервера|`SMB`|`445`|Используется для передачи файлов|
|Сетевая Файловая система|`NFS`|`111`, `2049`|Используется для подключения удаленных систем|
|Протокол начальной загрузки|`BOOTP`|`67`, `68`|Используется для начальной загрузки компьютеров|
|Керберос|`Kerberos`|`88`|Используется для аутентификации и авторизации|
|Облегченный Протокол доступа к Каталогу|`LDAP`|`389`|Используется для служб каталогов|
|Служба удалённой аутентификации по телефонной линии|`RADIUS`|`1812`, `1813`|Используется для аутентификации и авторизации|
|Протокол Динамической настройки хоста|`DHCP`|`67`, `68`|Используется для настройки IP-адресов|
|Протокол удаленного рабочего стола|`RDP`|`3389`|Используется для удаленного доступа к рабочему столу|
|Протокол Передачи сетевых новостей|`NNTP`|`119`|Используется для доступа к группам новостей|
|Удаленный вызов процедуры|`RPC`|`135`, `137-139`|Используется для вызова удаленных процедур|
|Протокол идентификации|`Ident`|`113`|Используется для идентификации пользовательских процессов|
|Протокол управляющих сообщений Интернета|`ICMP`|`0-255`|Используется для устранения неполадок в сети|
|Протокол управления Интернет-группами|`IGMP`|`0-255`|Используется для многоадресной рассылки|
|Oracle DB (по умолчанию/альтернатива) прослушиватель|`oracle-tns`|`1521`/`1526`|Слушатель базы данных Oracle по умолчанию/альтернативный слушатель — это служба, которая работает на хосте базы данных и принимает запросы от клиентов Oracle.|
|Блокировка входа|`ingreslock`|`1524`|База данных Ingres обычно используется в крупных коммерческих приложениях и в качестве бэкдора, позволяющего удалённо выполнять команды через RPC.|
|Веб-прокси Squid|`http-proxy`|`3128`|Веб-прокси Squid — это веб-прокси для кэширования и переадресации HTTP-запросов, который используется для ускорения работы веб-сервера за счёт кэширования повторяющихся запросов.|
|Протокол защищенного копирования|`SCP`|`22`|Безопасное копирование файлов между системами|
|Протокол начала сеанса|`SIP`|`5060`|Используется для сеансов VoIP|
|Простой протокол доступа к объекту|`SOAP`|`80`, `443`|Используется для веб-сервисов|
|Уровень Защищенного Сокета|`SSL`|`443`|Безопасная передача файлов|
|Обертки TCP|`TCPW`|`113`|Используется для контроля доступа|
|Ассоциация интернет-безопасности и протокол управления ключами|`ISAKMP`|`500`|Используется для VPN-подключений|
|Microsoft SQL Server|`ms-sql-s`|`1433`|Используется для подключения клиентов к Microsoft SQL Server.|
|Обмен ключами через Kerberized Internet|`KINK`|`892`|Используется для аутентификации и авторизации|
|Сначала откройте Кратчайший Путь|`OSPF`|`89`|Используется для маршрутизации|
|Протокол туннелирования «точка-точка»|`PPTP`|`1723`|Используется для создания VPN|
|Удаленное выполнение|`REXEC`|`512`|Этот протокол используется для выполнения команд на удалённых компьютерах и отправки результатов выполнения команд на локальный компьютер.|
|Удаленный Вход в систему|`RLOGIN`|`513`|Этот протокол запускает сеанс интерактивной командной оболочки на удалённом компьютере.|
|X Оконная система|`X11`|`6000`|Это компьютерная программная система и сетевой протокол, которые обеспечивают графический пользовательский интерфейс (GUI) для сетевых компьютеров.|
|Система управления реляционными базами данных|`DB2`|`50000`|СУБД предназначена для хранения, извлечения данных и управления ими в структурированном формате для корпоративных приложений, таких как финансовые системы, системы управления взаимоотношениями с клиентами (CRM).|

---

## Протокол пользовательских Дейтаграмм

С другой стороны, `UDP` — это `connectionless`-протокол, то есть он не устанавливает виртуальное соединение перед передачей данных. Вместо этого он отправляет пакеты данных получателю, не проверяя, были ли они получены.

Например, когда мы транслируем или смотрим видео на такой платформе, как YouTube, видеоданные передаются на наше устройство с помощью `UDP`. Это связано с тем, что видео может переносить некоторые потери данных, а скорость передачи важнее надёжности. Если несколько пакетов видеоданных будут потеряны, это не окажет существенного влияния на общее качество видео. Это делает `UDP` быстрее, чем TCP, но менее надёжным, поскольку нет гарантии, что пакеты дойдут до места назначения.

|**Протокол**|**Аббревиатура**|**Портвейн**|**Описание**|
|---|---|---|---|
|Система Доменных имен|`DNS`|`53`|Это протокол для преобразования доменных имён в IP-адреса.|
|Тривиальный протокол передачи файлов|`TFTP`|`69`|Он используется для передачи файлов между системами.|
|Протокол сетевого времени|`NTP`|`123`|Он синхронизирует компьютерные часы в сети.|
|Простой Протокол сетевого управления|`SNMP`|`161`|Он обеспечивает удалённый мониторинг и управление сетевыми устройствами.|
|Протокол маршрутизации информации|`RIP`|`520`|Он используется для обмена информацией о маршрутизации между маршрутизаторами.|
|Обмен ключами через Интернет|`IKE`|`500`|Обмен ключами через Интернет|
|Протокол начальной загрузки|`BOOTP`|`68`|Он используется для начальной загрузки хостов в сети.|
|Протокол Динамической настройки хоста|`DHCP`|`67`|Он используется для динамического назначения IP-адресов устройствам в сети.|
|Telnet|`TELNET`|`23`|Это текстовый протокол удалённого доступа.|
|MySQL|`MySQL`|`3306`|Это система управления базами данных с открытым исходным кодом.|
|Терминальный Сервер|`TS`|`3389`|Это протокол удалённого доступа, который по умолчанию используется в службах терминалов Microsoft Windows.|
|Имя NetBIOS|`netbios-ns`|`137`|Он используется в операционных системах Windows для преобразования имён NetBIOS в IP-адреса в локальной сети.|
|Microsoft SQL Server|`ms-sql-m`|`1434`|Используется для службы браузера Microsoft SQL Server.|
|Универсальный Подключи и играй|`UPnP`|`1900`|Это протокол, позволяющий устройствам обнаруживать друг друга в сети и обмениваться данными.|
|PostgreSQL|`PGSQL`|`5432`|Это объектно-реляционная система управления базами данных.|
|Виртуальные сетевые вычисления|`VNC`|`5900`|Это графическая система для обмена файлами на рабочем столе.|
|X Оконная система|`X11`|`6000-6063`|Это компьютерная программная система и сетевой протокол, обеспечивающие графический интерфейс в Unix-подобных системах.|
|Системный журнал|`SYSLOG`|`514`|Это стандартный протокол для сбора и хранения сообщений журнала в компьютерной системе.|
|Ретрансляционный Чат в Интернете|`IRC`|`194`|Это протокол обмена текстовыми сообщениями в режиме реального времени (чат) или протокол синхронной связи.|
|OpenPGP|`OpenPGP`|`11371`|Это протокол для шифрования и подписания данных и сообщений.|
|Безопасность Интернет-протокола|`IPsec`|`500`|IPsec — это также протокол, обеспечивающий безопасную зашифрованную связь. Он широко используется в VPN для создания безопасного туннеля между двумя устройствами.|
|Обмен ключами через Интернет|`IKE`|`11371`|Это протокол для шифрования и подписания данных и сообщений.|
|Протокол Управления X Display Manager|`XDMCP`|`177`|XDMCP — это сетевой протокол, который позволяет пользователю удалённо входить в систему на компьютере, на котором запущен X11.|

---

## ICMP

[Протокол управляющих сообщений Интернета](https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol) (`ICMP`) — это протокол, используемый устройствами для взаимодействия друг с другом в Интернете в различных целях, в том числе для отправки отчётов об ошибках и информации о состоянии. Он позволяет устройствам отправлять запросы и сообщения, которые можно использовать для отправки отчётов об ошибках или предоставления информации о состоянии.

#### Запросы ICMP

Запрос — это сообщение, отправляемое одним устройством другому для получения информации или выполнения определённого действия. Примером запроса в ICMP является `ping`-запрос, который проверяет связь между двумя устройствами. Когда одно устройство отправляет другому запрос ping, второе устройство отвечает `ping reply`-сообщением.

#### Сообщения ICMP

Сообщение в протоколе ICMP может быть как запросом, так и ответом. Помимо запросов и ответов ping, ICMP поддерживает другие типы сообщений, такие как сообщения об ошибках, `destination unreachable` и `time exceeded` сообщения. Эти сообщения используются для передачи различных типов информации и сообщений об ошибках между устройствами в сети.

Например, если устройство пытается отправить пакет данных на другое устройство, но пакет не может быть доставлен, устройство может использовать протокол ICMP для отправки сообщения об ошибке отправителю. Протокол ICMP имеет две разные версии:

- `ICMPv4`: Только для IPv4
- `ICMPv6`: Только для IPv6

ICMPv4 — это первоначальная версия `ICMP`, разработанная для использования с протоколом IPv4. Она до сих пор широко применяется и является наиболее распространённой версией ICMP. С другой стороны, ICMPv6 был разработан для протокола IPv6. Он обладает дополнительными функциями и предназначен для устранения некоторых ограничений ICMPv4.

|**Тип запроса**|**Описание**|
|---|---|
|`Echo Request`|Это сообщение проверяет, доступно ли устройство в сети. Когда устройство отправляет эхо-запрос, оно ожидает получить эхо-ответ. Например, инструменты `tracert` (Windows) или `traceroute` (Linux) всегда отправляют эхо-запросы ICMP.|
|`Timestamp Request`|Это сообщение определяет время на удалённом устройстве.|
|`Address Mask Request`|Это сообщение используется для запроса маски подсети устройства.|

|**Тип сообщения**|**Описание**|
|---|---|
|`Echo reply`|Это сообщение отправляется в ответ на эхо-запрос.|
|`Destination unreachable`|Это сообщение отправляется, когда устройство не может доставить пакет данных по назначению.|
|`Redirect`|Маршрутизатор отправляет это сообщение, чтобы сообщить устройству, что оно должно отправлять свои пакеты на другой маршрутизатор.|
|`time exceeded`|Это сообщение отправляется, когда пакету требуется слишком много времени, чтобы добраться до пункта назначения.|
|`Parameter problem`|Это сообщение отправляется при возникновении проблем с заголовком пакета.|
|`Source quench`|Это сообщение отправляется, когда устройство получает пакеты слишком быстро и не успевает их обрабатывать. Оно используется для замедления потока пакетов.|

Ещё одна важная для нас часть ICMP — это поле [Time-To-Live](https://en.wikipedia.org/wiki/Time_to_live) (`TTL`) в заголовке пакета ICMP, которое ограничивает время жизни пакета при его передаче по сети. Оно предотвращает бесконечную циркуляцию пакетов в сети в случае возникновения петель маршрутизации. Каждый раз, когда пакет проходит через маршрутизатор, маршрутизатор уменьшает значение `TTL value by 1`. Когда значение TTL достигает `0`, маршрутизатор отбрасывает пакет и отправляет отправителю сообщение ICMP `Time Exceeded` об ошибке.

Мы также можем использовать `TTL` для определения количества переходов, которые совершил пакет, и приблизительного расстояния до пункта назначения. Например, если пакет имеет `TTL` значение 10 и проходит 5 переходов, прежде чем достигнет пункта назначения, можно сделать вывод, что пункт назначения находится примерно в 5 переходах от него. Например, если мы видим пинг со значением `TTL` равным `122`, это может означать, что мы имеем дело с системой Windows (`TTL 128` по умолчанию), которая находится в 6 переходах от нас.

Однако можно также определить операционную систему по значению `TTL` по умолчанию, используемому устройством. Каждая операционная система обычно имеет значение `TTL` по умолчанию при отправке пакетов. Это значение задаётся в заголовке пакета и уменьшается на 1 при каждом прохождении пакета через маршрутизатор. Таким образом, изучив значение `TTL` по умолчанию на устройстве, можно определить, какую операционную систему оно использует. Например, в системах Windows (`2000/XP/2003/Vista/10`) значение `TTL` по умолчанию обычно равно 128, в системах macOS и Linux значение `TTL` по умолчанию обычно равно 64, а в Solaris значение `TTL` по умолчанию равно 255. Однако важно отметить, что пользователь может изменить эти значения, поэтому они не должны зависеть от способа определения операционной системы устройства.

---

## VoIP

[Передача голоса по интернет-протоколу](https://www.fcc.gov/general/voice-over-internet-protocol-voip) (`VoIP`) — это метод передачи голоса и мультимедийной информации. Например, он позволяет совершать телефонные звонки с использованием широкополосного интернет-соединения вместо традиционной телефонной линии, как в Skype, Whatsapp, Google Hangouts, Slack, Zoom и других приложениях.

Наиболее распространёнными портами VoIP являются `TCP/5060` и `TCP/5061`, которые используются для [протокола инициации сеанса](https://en.wikipedia.org/wiki/Session_Initiation_Protocol) (SIP). Однако порт `TCP/1720` также может использоваться некоторыми системами VoIP для [протокола H.323](https://en.wikipedia.org/wiki/H.323) — набора стандартов для мультимедийной связи в пакетных сетях. Тем не менее в системах VoIP SIP используется чаще, чем H.323.

Тем не менее SIP — это протокол сигнализации для инициирования, поддержания, изменения и завершения сеансов связи в режиме реального времени с использованием видео, голосовой связи, обмена сообщениями и других коммуникационных приложений и сервисов между двумя или более конечными точками в Интернете. Поэтому он использует запросы и методы взаимодействия между конечными точками. Наиболее распространённые запросы и методы SIP:

|**Способ**|**Описание**|
|---|---|
|`INVITE`|Инициирует сеанс или приглашает другую конечную точку к участию.|
|`ACK`|Подтверждает получение запроса INVITE.|
|`BYE`|Завершите сеанс.|
|`CANCEL`|Отменяет ожидающий обработки запрос INVITE.|
|`REGISTER`|Регистрирует пользовательский агент SIP (UA) на SIP-сервере.|
|`OPTIONS`|Запрашивает информацию о возможностях SIP-сервера или пользовательского агента, например о поддерживаемых типах мультимедиа.|

#### Раскрытие информации

Однако SIP позволяет нам выявлять существующих пользователей для потенциальных атак. Это можно делать для разных целей, например чтобы определить доступность пользователя, узнать информацию о его возможностях или услугах или впоследствии провести атаку методом перебора на его учётную запись.

Один из возможных способов перечисления пользователей — запрос SIP `OPTIONS` . Это метод, используемый для запроса информации о возможностях SIP-сервера или пользовательских агентов, например о типах поддерживаемых медиафайлов, кодеках, которые они могут декодировать, и других деталях. Запрос `OPTIONS` позволяет получить информацию о SIP-сервере или пользовательском агенте или проверить их подключение и доступность.

В ходе нашего анализа мы обнаружили файл `SEPxxxx.cnf`, где `xxxx` — это уникальный идентификатор. Это файл конфигурации, используемый Cisco Unified Communications Manager, ранее известным как Cisco CallManager, для определения настроек и параметров унифицированного IP-телефона Cisco. В файле указаны модель телефона, версия прошивки, сетевые настройки и другие сведения.