#htb #linux 

При работе с Linux необходимо управлять различными сетевыми службами. Умение работать с этими службами имеет решающее значение по нескольким причинам. Сетевые службы предназначены для выполнения конкретных задач, многие из которых позволяют осуществлять удалённые операции. Важно обладать знаниями и навыками для взаимодействия с другими компьютерами по сети, установления соединений, передачи файлов, анализа сетевого трафика и эффективной настройки этих служб. Эти знания позволяют нам выявлять потенциальные уязвимости во время тестирования на проникновение. Кроме того, понимание возможностей настройки каждой службы улучшает наше общее представление о сетевой безопасности.

Рассмотрим сценарий, в котором мы проводим тест на проникновение и обнаруживаем хост Linux, который проверяется на наличие уязвимостей. Наблюдая за сетевым трафиком, мы видим, что пользователь на этом хосте Linux подключается к другому серверу через незашифрованный FTP-сервер. Следовательно, мы можем перехватить учётные данные пользователя в открытом виде. Такая ситуация была бы гораздо менее вероятной, если бы пользователь знал, что FTP не шифрует соединения или передаваемые данные. Для администратора Linux это серьёзная ошибка, поскольку она не только выявляет уязвимости в системе безопасности сети, но и негативно сказывается на администраторах, ответственных за поддержание безопасности сети.

Хотя невозможно охватить все сетевые службы, мы сосредоточимся на наиболее важных из них. Такой подход полезен не только для администраторов и пользователей, но и для специалистов по тестированию на проникновение, которым необходимо понимать взаимодействие между различными хостами и их собственными системами.

---

## SSH

Secure Shell (`SSH`) — это сетевой протокол, который обеспечивает безопасную передачу данных и команд по сети. Он широко используется для безопасного управления удалёнными системами и безопасного доступа к удалённым системам для выполнения команд или передачи файлов. Чтобы подключиться к нашему или удалённому хосту Linux по SSH, должен быть доступен и запущен соответствующий SSH-сервер.

Наиболее часто используемым SSH-сервером является сервер OpenSSH. OpenSSH — это бесплатная реализация протокола Secure Shell (SSH) с открытым исходным кодом, которая обеспечивает безопасную передачу данных и команд по сети.

Администраторы используют OpenSSH для безопасного управления удалёнными системами, устанавливая зашифрованное соединение с удалённым хостом. С помощью OpenSSH администраторы могут выполнять команды в удалённых системах, безопасно передавать файлы и устанавливать защищённое удалённое соединение без перехвата данных и команд третьими лицами.

#### Установить OpenSSH

  Сетевые службы

```shell-session
Barlogsha@htb[/htb]$ sudo apt install openssh-server -y
```

Чтобы проверить, запущен ли сервер, мы можем использовать следующую команду:

#### Статус сервера

  Сетевые службы

```shell-session
Barlogsha@htb[/htb]$ systemctl status ssh

● ssh.service - OpenBSD Secure Shell server
     Loaded: loaded (/lib/system/system/ssh.service; enabled; vendor preset: enabled)
     Active: active (running) since Sun 2023-02-12 21:15:27 GMT; 1min 22s ago
       Docs: man:sshd(8)
             man:sshd_config(5)
   Main PID: 7740 (sshd)
      Tasks: 1 (limit: 9458)
     Memory: 2.5M
        CPU: 236ms
     CGroup: /system.slice/ssh.service
             └─7740 sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups
```

Как специалисты по тестированию на проникновение, мы используем OpenSSH для безопасного доступа к удалённым системам при проведении аудита сети. Для этого мы можем использовать следующую команду:

#### SSH - Вход в систему

  Сетевые службы

```shell-session
Barlogsha@htb[/htb]$ ssh cry0l1t3@10.129.17.122

The authenticity of host '10.129.17.122 (10.129.17.122)' can't be established.
ECDSA key fingerprint is SHA256:bKzhv+n2pYqr2r...Egf8LfqaHNxk.

Are you sure you want to continue connecting (yes/no/[fingerprint])? yes

Warning: Permanently added '10.129.17.122' (ECDSA) to the list of known hosts.

cry0l1t3@10.129.17.122's password: ***********
```

OpenSSH можно настроить и изменить, отредактировав файл `/etc/ssh/sshd_config` с помощью текстового редактора. Здесь мы можем изменить такие параметры, как максимальное количество одновременных подключений, использование паролей или ключей для входа в систему, проверку ключей хоста и многое другое. Однако важно отметить, что вносить изменения в файл конфигурации OpenSSH нужно осторожно.

Например, мы можем использовать SSH для безопасного входа в удалённую систему и выполнения команд или использовать туннелирование и переадресацию портов для передачи данных по зашифрованному соединению, чтобы проверить настройки сети и другие системные настройки без возможности перехвата данных и команд третьими лицами.

---

## NFS

Сетевая файловая система (`NFS`) — это сетевой протокол, который позволяет хранить файлы в удалённых системах и управлять ими так, как если бы они хранились в локальной системе. Это обеспечивает простое и эффективное управление файлами в сетях. Например, администраторы используют NFS для централизованного хранения файлов и управления ими (в системах Linux и Windows) для упрощения совместной работы и управления данными. Для Linux существует несколько серверов NFS, в том числе NFS-UTILS (`Ubuntu`), NFS-Ganesha (`Solaris`), и OpenNFS (`Redhat Linux`).

Его также можно использовать для эффективного совместного использования ресурсов и управления ими, например, для репликации файловых систем между серверами. Он также предлагает такие функции, как контроль доступа, передача файлов в реальном времени и поддержка одновременного доступа к данным для нескольких пользователей. Мы можем использовать этот сервис так же, как FTP, если в целевой системе не установлен FTP-клиент или вместо FTP используется NFS.

Мы можем установить NFS в Linux с помощью следующей команды:

#### Установить NFS

  Сетевые службы

```shell-session
Barlogsha@htb[/htb]$ sudo apt install nfs-kernel-server -y
```

Чтобы проверить, запущен ли сервер, мы можем использовать следующую команду:

#### Статус сервера

  Сетевые службы

```shell-session
Barlogsha@htb[/htb]$ systemctl status nfs-kernel-server

● nfs-server.service - NFS server and services
     Loaded: loaded (/lib/system/system/nfs-server.service; enabled; vendor preset: enabled)
     Active: active (exited) since Sun 2023-02-12 21:35:17 GMT; 13s ago
    Process: 9234 ExecStartPre=/usr/sbin/exportfs -r (code=exited, status=0/SUCCESS)
    Process: 9235 ExecStart=/usr/sbin/rpc.nfsd $RPCNFSDARGS (code=exited, status=0/SUCCESS)
   Main PID: 9235 (code=exited, status=0/SUCCESS)
        CPU: 10ms
```

Мы можем настроить NFS с помощью файла конфигурации `/etc/exports`. В этом файле указывается, какие каталоги должны быть общими, а также права доступа для пользователей и систем. Также можно настроить такие параметры, как скорость передачи данных и использование шифрования. Права доступа NFS определяют, какие пользователи и системы могут получить доступ к общим каталогам и какие действия они могут выполнять. Вот некоторые важные права доступа, которые можно настроить в NFS:

|**Разрешения**|**Описание**|
|---|---|
|`rw`|Предоставляет пользователям и системам разрешения на чтение и запись в общий каталог.|
|`ro`|Предоставляет пользователям и системам доступ только для чтения к общему каталогу.|
|`no_root_squash`|Не позволяет ограничить права пользователя root на клиенте правами обычного пользователя.|
|`root_squash`|Ограничивает права пользователя root на клиенте до прав обычного пользователя.|
|`sync`|Синхронизирует передачу данных, чтобы изменения передавались только после их сохранения в файловой системе.|
|`async`|Передаёт данные асинхронно, что ускоряет передачу, но может привести к несоответствиям в файловой системе, если изменения не были полностью зафиксированы.|

Например, мы можем создать новую папку и временно предоставить к ней общий доступ в NFS. Это можно сделать следующим образом:

#### Создание общего ресурса NFS

  Сетевые службы

```shell-session
cry0l1t3@htb:~$ mkdir nfs_sharing
cry0l1t3@htb:~$ echo '/home/cry0l1t3/nfs_sharing hostname(rw,sync,no_root_squash)' >> /etc/exports
cry0l1t3@htb:~$ cat /etc/exports | grep -v "#"

/home/cry0l1t3/nfs_sharing hostname(rw,sync,no_root_squash)
```

Если мы создали общий ресурс NFS и хотим работать с ним в целевой системе, нам нужно сначала подключить его. Это можно сделать с помощью следующей команды:

#### Смонтировать общий ресурс NFS

  Сетевые службы

```shell-session
cry0l1t3@htb:~$ mkdir ~/target_nfs
cry0l1t3@htb:~$ mount 10.129.12.17:/home/john/dev_scripts ~/target_nfs
cry0l1t3@htb:~$ tree ~/target_nfs

target_nfs/
├── css.css
├── html.html
├── javascript.js
├── php.php
└── xml.xml

0 directories, 5 files
```

Таким образом, мы подключили общий ресурс NFS (`dev_scripts`) из нашей целевой системы (`10.129.12.17`) локально к нашей системе в точке подключения `target_nfs` по сети и можем просматривать содержимое так же, как если бы мы находились в целевой системе. Существуют даже некоторые методы, которые можно использовать в конкретных случаях для повышения наших привилегий в удалённой системе с помощью NFS.

---

## Веб-сервер

Понимание принципов работы веб-серверов важно для специалистов по тестированию на проникновение, поскольку эти серверы являются неотъемлемой частью веб-приложений и часто служат основными целями при оценке безопасности. Веб-сервер — это программное обеспечение, которое предоставляет данные, документы, приложения и различные функции через Интернет. Он использует протокол передачи гипертекста (`HTTP`) для передачи данных клиентам, таким как веб-браузеры, и для получения запросов от этих клиентов. Полученные данные затем отображаются в виде языка гипертекстовой разметки (`HTML`) в браузере клиента, что упрощает создание динамических веб-страниц, которые интерактивно реагируют на запросы пользователей. Следовательно, глубокое понимание функций веб-серверов крайне важно для разработки безопасных и эффективных веб-приложений, а также для обеспечения общей безопасности системы. Среди наиболее широко используемых веб-серверов на платформах Linux — Apache, Nginx, Lighttpd и Caddy. Apache особенно популярен благодаря своей широкой совместимости с операционными системами, включая Ubuntu, Solaris и Red Hat Linux.

Для специалистов по тестированию на проникновение веб-серверы предоставляют различные утилиты. Их можно использовать для передачи файлов, что позволяет тестировщикам входить в систему и взаимодействовать с целевыми системами через порты HTTP или HTTPS. Кроме того, веб-серверы можно использовать для проведения фишинговых атак, размещая на них копии целевых страниц и пытаясь получить учётные данные пользователей. Помимо этих возможностей, веб-серверы предоставляют множество других вариантов для тестирования и использования уязвимостей в сети.

Веб-сервер Apache обладает множеством функций, которые позволяют размещать безопасные и эффективные веб-приложения. Кроме того, мы можем настроить ведение журнала для получения информации о трафике на нашем сервере, что помогает нам анализировать атаки. Мы можем установить Apache с помощью следующей команды:

#### Установить веб-сервер Apache

  Сетевые службы

```shell-session
Barlogsha@htb[/htb]$ sudo apt install apache2 -y
```

Для Apache2, чтобы указать, к каким папкам можно получить доступ, мы можем отредактировать файл `/etc/apache2/apache2.conf` с помощью текстового редактора. Этот файл содержит глобальные настройки. Мы можем изменить настройки, чтобы указать, к каким каталогам можно получить доступ и какие действия можно выполнять в этих каталогах.

#### Конфигурация Apache

Код: txt

```txt
<Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
</directory>
```

В этом разделе указано, что папка `/var/www/html` по умолчанию доступна, что пользователи могут использовать опции `Indexes` и `FollowSymLinks`, что изменения в файлах в этом каталоге могут быть отменены с помощью `AllowOverride All` и что `Require all granted` предоставляет всем пользователям доступ к этому каталогу. Например, если мы хотим передать файлы в одну из наших целевых систем с помощью веб-сервера, мы можем поместить соответствующие файлы в папку `/var/www/html` и использовать `wget` или `curl` или другие приложения для загрузки этих файлов в целевую систему.

Также можно настроить отдельные параметры на уровне каталога с помощью файла `.htaccess`, который мы можем создать в нужном каталоге. Этот файл позволяет настроить определённые параметры на уровне каталога, например контроль доступа, без необходимости настраивать файл конфигурации Apache. Мы также можем добавить модули для получения таких функций, как `mod_rewrite`, `mod_security`, и `mod_ssl`, которые помогут нам повысить безопасность нашего веб-приложения.

Веб-сервер Python — это простая и быстрая альтернатива Apache, которую можно использовать для размещения одной папки с помощью одной команды для передачи файлов в другую систему. Чтобы установить веб-сервер Python, нам нужно установить Python3 в нашей системе, а затем выполнить следующую команду:

#### Установка Python и веб-сервера

  Сетевые службы

```shell-session
Barlogsha@htb[/htb]$ sudo apt install python3 -y
Barlogsha@htb[/htb]$ python3 -m http.server
```

Когда мы запустим эту команду, наш веб-сервер Python будет работать на порту `TCP/8000`, и мы сможем получить доступ к папке, в которой находимся. Мы также можем разместить другую папку с помощью следующей команды:

  Сетевые службы

```shell-session
Barlogsha@htb[/htb]$ python3 -m http.server --directory /home/cry0l1t3/target_files
```

Это запустит веб-сервер Python на порту `TCP/8000`, и мы сможем получить доступ к папке `/home/cry0l1t3/target_files` из браузера, например. Когда мы получаем доступ к нашему веб-серверу Python, мы можем передавать файлы в другую систему, введя ссылку в браузере и загрузив файлы. Мы также можем разместить наш веб-сервер Python на порту, отличном от порта по умолчанию:

  Сетевые службы

```shell-session
Barlogsha@htb[/htb]$ python3 -m http.server 443
```

Это позволит разместить наш веб-сервер Python на порту 443 вместо порта `TCP/8000` по умолчанию. Мы можем получить доступ к этому веб-серверу, введя ссылку в браузере.

---

## VPN

Виртуальная частная сеть (`VPN`) работает как защищённый невидимый туннель, который соединяет нас с другой сетью, обеспечивая бесперебойный и защищённый доступ, как если бы мы физически находились в ней. Это достигается путём создания зашифрованного туннеля между клиентом и сервером, благодаря чему все данные, передаваемые по этому соединению, остаются конфиденциальными и защищёнными от несанкционированного доступа.

Организации в основном используют VPN, чтобы предоставить своим сотрудникам безопасный доступ к внутренней сети, не требуя их присутствия на рабочем месте. Такая гибкость позволяет сотрудникам получать доступ к внутренним ресурсам и приложениям из любого места, повышая производительность и мобильность. Кроме того, VPN служат для анонимизации интернет-трафика и блокировки внешних вторжений, что дополнительно повышает безопасность.

Среди наиболее широко используемых VPN-решений для серверов Linux — OpenVPN, L2TP/IPsec, PPTP, SSTP и SoftEther. OpenVPN — популярный вариант с открытым исходным кодом, совместимый с различными операционными системами, включая Ubuntu, Solaris и Red Hat Linux. Администраторы используют OpenVPN для обеспечения безопасного удалённого доступа к корпоративным сетям, шифрования сетевого трафика и сохранения анонимности пользователей в интернете.

Для специалистов по тестированию на проникновение OpenVPN предоставляет бесценные возможности. Он позволяет тестировщикам безопасно подключаться к внутренним сетям, особенно когда прямой доступ невозможен из-за географических ограничений. Используя OpenVPN, специалисты по тестированию на проникновение могут проводить комплексную оценку безопасности внутренних систем, выявляя и устраняя потенциальные уязвимости. Универсальность OpenVPN с такими функциями, как шифрование, туннелирование, формирование трафика, маршрутизация сети и адаптация к динамическим сетевым средам, делает его важным инструментом в арсенале как сетевых администраторов, так и специалистов по безопасности. Мы можем установить сервер и клиент с помощью следующей команды:

#### Установить OpenVPN

  Сетевые службы

```shell-session
Barlogsha@htb[/htb]$ sudo apt install openvpn -y
```

OpenVPN можно настроить, отредактировав файл конфигурации `/etc/openvpn/server.conf`. Этот файл содержит настройки для сервера OpenVPN. Мы можем изменить настройки для определённых функций, таких как шифрование, туннелирование, формирование трафика и т. д.

Если мы хотим подключиться к серверу OpenVPN, мы можем использовать файл `.ovpn`, который получили с сервера, и сохранить его в нашей системе. Это можно сделать с помощью следующей команды в командной строке:

#### Подключение к VPN

  Сетевые службы

```shell-session
Barlogsha@htb[/htb]$ sudo openvpn --config internal.ovpn
```

После установления соединения мы можем взаимодействовать с внутренними хостами во внутренней сети.