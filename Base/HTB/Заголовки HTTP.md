#htb #web #http 

В предыдущем разделе мы рассмотрели примеры HTTP-запросов и заголовков ответов. Такие HTTP-заголовки передают информацию между клиентом и сервером. Некоторые заголовки используются только в запросах или ответах, в то время как другие общие заголовки используются в обоих случаях.

Заголовки могут содержать одно или несколько значений, которые добавляются после имени заголовка и разделяются двоеточием. Мы можем разделить заголовки на следующие категории:

1. `General Headers`
2. `Entity Headers`
3. `Request Headers`
4. `Response Headers`
5. `Security Headers`

Давайте обсудим каждую из этих категорий.

---

## Общие заголовки

[Общие заголовки](https://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html) используются как в HTTP-запросах, так и в ответах. Они контекстуальны и используются для `describe the message rather than its contents`.

|**Заголовок**|**Пример**|**Описание**|
|---|---|---|
|`Date`|`Date: Wed, 16 Feb 2022 10:38:44 GMT`|Содержит дату и время отправки сообщения. Рекомендуется преобразовать время в стандартный часовой пояс [UTC](https://en.wikipedia.org/wiki/Coordinated_Universal_Time).|
|`Connection`|`Connection: close`|Определяет, должно ли текущее сетевое соединение оставаться активным после завершения запроса. Два наиболее часто используемых значения для этого заголовка — `close` и `keep-alive`. Значение `close` от клиента или сервера означает, что они хотят завершить соединение, а заголовок `keep-alive` указывает, что соединение должно оставаться открытым для получения дополнительных данных и ввода.|

---

## Заголовки сущностей

Как и общие заголовки, [заголовки сущностей](https://www.w3.org/Protocols/rfc2616/rfc2616-sec7.html) могут быть `common to both the request and response`. Эти заголовки используются для `describe the content` (сущности), передаваемой в сообщении. Обычно они встречаются в ответах и запросах POST или PUT.

|**Заголовок**|**Пример**|**Описание**|
|---|---|---|
|`Content-Type`|`Content-Type: text/html`|Используется для описания типа передаваемого ресурса. Значение автоматически добавляется браузерами на стороне клиента и возвращается в ответе сервера. Поле `charset` обозначает стандарт кодирования, например [UTF-8](https://en.wikipedia.org/wiki/UTF-8).|
|`Media-Type`|`Media-Type: application/pdf`|`media-type` похож на `Content-Type` и описывает передаваемые данные. Этот заголовок может сыграть решающую роль в том, как сервер интерпретирует наши входные данные. Поле `charset` также может использоваться с этим заголовком.|
|`Boundary`|`boundary="b4e4fbd93540"`|Выступает в качестве маркера для разделения контента, если в одном сообщении содержится несколько элементов. Например, в данных формы этот маркер используется как `--b4e4fbd93540` для разделения различных частей формы.|
|`Content-Length`|`Content-Length: 385`|Содержит размер передаваемого объекта. Этот заголовок необходим, так как сервер использует его для чтения данных из тела сообщения. Он автоматически генерируется браузером и такими инструментами, как cURL.|
|`Content-Encoding`|`Content-Encoding: gzip`|Перед передачей данные могут быть подвергнуты множеству преобразований. Например, большие объёмы данных могут быть сжаты для уменьшения размера сообщения. Тип используемого кодирования должен быть указан в заголовке `Content-Encoding`|

---

## Заголовки запроса

Клиент отправляет [заголовки запроса](https://tools.ietf.org/html/rfc2616) в рамках HTTP-транзакции. Эти заголовки являются `used in an HTTP request and do not relate to the content` сообщения. В HTTP-запросах обычно встречаются следующие заголовки.

|**Заголовок**|**Пример**|**Описание**|
|---|---|---|
|`Host`|`Host: www.inlanefreight.com`|Используется для указания хоста, к которому осуществляется запрос ресурса. Это может быть доменное имя или IP-адрес. HTTP-серверы могут быть настроены для размещения различных веб-сайтов, которые определяются по имени хоста. Это делает заголовок хоста важной целью для перечисления, поскольку он может указывать на наличие других хостов на целевом сервере.|
|`User-Agent`|`User-Agent: curl/7.77.0`|Заголовок `User-Agent` используется для описания клиента, запрашивающего ресурсы. Этот заголовок может многое рассказать о клиенте, например о браузере, его версии и операционной системе.|
|`Referer`|`Referer: http://www.inlanefreight.com/`|Указывает источник текущего запроса. Например, при переходе по ссылке из результатов поиска Google `https://google.com` будет являться реферером. Доверять этому заголовку может быть опасно, так как им легко манипулировать, что может привести к непредвиденным последствиям.|
|`Accept`|`Accept: */*`|Заголовок `Accept` описывает, какие типы мультимедиа может распознавать клиент. Он может содержать несколько типов мультимедиа, разделённых запятыми. Значение `*/*` означает, что принимаются все типы мультимедиа.|
|`Cookie`|`Cookie: PHPSESSID=b4e4fbd93540`|Содержит пары «куки-значение» в формате `name=value`.[Куки](https://en.wikipedia.org/wiki/HTTP_cookie) — это фрагмент данных, который хранится на стороне клиента и на сервере и служит идентификатором. Они передаются на сервер с каждым запросом, обеспечивая тем самым доступ клиента. Куки могут использоваться и для других целей, например для сохранения пользовательских настроек или отслеживания сеанса. В одном заголовке может быть несколько куки, разделённых точкой с запятой.|
|`Authorization`|`Authorization: BASIC cGFzc3dvcmQK`|Другой способ идентификации клиентов для сервера. После успешной аутентификации сервер возвращает уникальный для клиента токен. В отличие от файлов cookie, токены хранятся только на стороне клиента и запрашиваются сервером при каждом обращении. Существует несколько типов аутентификации в зависимости от используемого веб-сервера и типа приложения.|

Полный список заголовков запросов и их назначение можно найти [здесь](https://tools.ietf.org/html/rfc7231#section-5).

---

## Заголовки ответа

[Заголовки ответа](https://tools.ietf.org/html/rfc7231#section-7) могут быть `used in an HTTP response and do not relate to the content`. Некоторые заголовки ответа, такие как `Age`, `Location`, и `Server`, используются для предоставления дополнительной информации об ответе. В HTTP-ответах обычно встречаются следующие заголовки.

|**Заголовок**|**Пример**|**Описание**|
|---|---|---|
|`Server`|`Server: Apache/2.2.14 (Win32)`|Содержит информацию о HTTP-сервере, который обработал запрос. С его помощью можно получить информацию о сервере, например его версию, и продолжить его перехват.|
|`Set-Cookie`|`Set-Cookie: PHPSESSID=b4e4fbd93540`|Содержит файлы cookie, необходимые для идентификации клиента. Браузеры анализируют файлы cookie и сохраняют их для будущих запросов. Этот заголовок имеет тот же формат, что и заголовок `Cookie` запроса.|
|`WWW-Authenticate`|`WWW-Authenticate: BASIC realm="localhost"`|Уведомляет клиента о типе аутентификации, необходимой для доступа к запрашиваемому ресурсу.|

---

## Заголовки безопасности

Наконец, у нас есть [заголовки безопасности](https://owasp.org/www-project-secure-headers/). С ростом разнообразия браузеров и веб-атак возникла необходимость в определении определённых заголовков, повышающих безопасность. Заголовки HTTP Security — это `a class of response headers used to specify certain rules and policies` параметры, которые браузер должен учитывать при доступе к веб-сайту.

|**Заголовок**|**Пример**|**Описание**|
|---|---|---|
|`Content-Security-Policy`|`Content-Security-Policy: script-src 'self'`|Определяет политику веб-сайта в отношении внешних ресурсов. Это может быть как код JavaScript, так и ресурсы скриптов. Этот заголовок указывает браузеру принимать ресурсы только с определённых доверенных доменов, что предотвращает такие атаки, как [межсайтовый скриптинг (XSS)](https://en.wikipedia.org/wiki/Cross-site_scripting).|
|`Strict-Transport-Security`|`Strict-Transport-Security: max-age=31536000`|Запрещает браузеру доступ к веб-сайту по незащищённому протоколу HTTP и обеспечивает передачу данных по защищённому протоколу HTTPS. Это не позволяет злоумышленникам перехватывать веб-трафик и получать доступ к защищённой информации, такой как пароли или другие конфиденциальные данные.|
|`Referrer-Policy`|`Referrer-Policy: origin`|Определяет, должен ли браузер включать значение, указанное в заголовке `Referer`, или нет. Это может помочь избежать раскрытия конфиденциальных URL-адресов и информации при просмотре веб-сайта.|

**Примечание:** в этом разделе упоминается лишь небольшая часть часто встречающихся HTTP-заголовков. Существует множество других контекстных заголовков, которые можно использовать при передаче данных по протоколу HTTP. Кроме того, приложения могут определять собственные заголовки в соответствии со своими требованиями. Полный список стандартных HTTP-заголовков можно найти [здесь](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers).

---

## cURL

В предыдущем разделе мы увидели, как с помощью флага `-v` в cURL можно получить полную информацию о HTTP-запросе и ответе. Если нам нужны только заголовки ответа, мы можем использовать флаг `-I` для отправки `HEAD`-запроса и отображения только заголовков ответа. Кроме того, мы можем использовать флаг `-i` для отображения как заголовков, так и тела ответа (например, HTML-кода). Разница между ними заключается в том, что `-I` отправляет запрос `HEAD` (как мы увидим в следующем разделе), а `-i` отправляет любой указанный нами запрос и также выводит заголовки.

В следующей команде показан пример вывода при использовании флага `-I`:

  Заголовки HTTP

```shell-session
Barlogsha@htb[/htb]$ curl -I https://www.inlanefreight.com

Host: www.inlanefreight.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/605.1.15 (KHTML, like Gecko)
Cookie: cookie1=298zf09hf012fh2; cookie2=u32t4o3tb3gg4
Accept: text/plain
Referer: https://www.inlanefreight.com/
Authorization: BASIC cGFzc3dvcmQK

Date: Sun, 06 Aug 2020 08:49:37 GMT
Connection: keep-alive
Content-Length: 26012
Content-Type: text/html; charset=ISO-8859-4
Content-Encoding: gzip
Server: Apache/2.2.14 (Win32)
Set-Cookie: name1=value1,name2=value2; Expires=Wed, 09 Jun 2021 10:18:14 GMT
WWW-Authenticate: BASIC realm="localhost"
Content-Security-Policy: script-src 'self'
Strict-Transport-Security: max-age=31536000
Referrer-Policy: origin
```

**Упражнение:** Попробуйте просмотреть все приведенные выше заголовки и вспомнить, как они используются.

Помимо просмотра заголовков, cURL также позволяет нам устанавливать заголовки запросов с помощью флага `-H`, как мы увидим в следующем разделе. Некоторые заголовки, например `User-Agent` или `Cookie`, имеют собственные флаги. Например, мы можем использовать `-A` для установки `User-Agent` следующим образом:

  Заголовки HTTP

```shell-session
Barlogsha@htb[/htb]$ curl https://www.inlanefreight.com -A 'Mozilla/5.0'

<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
...SNIP...
```

**Упражнение:** Попробуйте использовать флаги `-I` или `-v` в приведённом выше примере, чтобы убедиться, что мы изменили User-Agent с помощью флага `-A` .

---

## Браузерные инструменты разработчика

Наконец, давайте посмотрим, как можно просмотреть HTTP-заголовки с помощью инструментов разработчика в браузере. Как и в предыдущем разделе, мы можем перейти на вкладку `Network`, чтобы просмотреть различные запросы, сделанные страницей. Мы можем нажать на любой из запросов, чтобы просмотреть его детали: ![[Pasted image 20260127203232.png]]

На первой вкладке `Headers` мы видим заголовки HTTP-запроса и HTTP-ответа. Инструменты разработчика автоматически распределяют заголовки по разделам, но мы можем нажать на кнопку `Raw`, чтобы просмотреть их в исходном формате. Кроме того, на вкладке `Cookies` можно увидеть файлы cookie, используемые в запросе, как описано в следующем разделе.
