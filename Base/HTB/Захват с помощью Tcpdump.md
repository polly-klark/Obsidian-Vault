#tcpdump #network #traffic #htb 

Цель этого лабораторного занятия — познакомить нас с tcpdump и дать нам время освоиться с терминалом и инструментами, которые в нём используются. Мы попрактикуемся в различных базовых функциях tcpdump, таких как чтение и запись в файлы, использование основных переключателей и поиск файлов в терминале. Выполняя эти лабораторные задания, мы можем изучить и попрактиковаться в использовании различных переключателей и функций tcpdump. Когда освоитесь, попробуйте определить, можем ли мы увидеть какой-либо трафик в сети.

Имейте в виду, что этот тип работы часто используется для более детального изучения конкретных хостов и серверов и выяснения того, с кем они взаимодействуют. Эту процедуру также можно использовать для выявления так называемых бэкдоров или других потенциальных уязвимостей. С её помощью можно отслеживать и регистрировать все коммуникации с одного сервера, чтобы анализировать отправленные и полученные пакеты. Для самого анализа мы используем различные фильтры и шаблоны для отсеивания подозрительных пакетов. Мы рассмотрим это в другом разделе.

Как новому сетевому администратору корпорации, нам было поручено перехватить часть сетевого трафика, чтобы определить базовые параметры и проверить работоспособность сети корпорации. В качестве теста мы используем tcpdump, чтобы перехватить небольшой фрагмент трафика в нашем локальном широковещательном домене и убедиться, что наше устройство для перехвата трафика справится с этой задачей. Нам нужно убедиться, что установлены необходимые инструменты и зависимости, а также проверить нашу способность считывать трафик и сохранять его в файл.

Если вы хотите подойти к выполнению этого лабораторного задания более творчески, я опубликовал список общих задач. Более подробное описание того, как выполнить каждый шаг, приведено под каждой задачей в блоке с решениями.

---

## Задачи

#### Задача №1

`Validate Tcpdump is installed on our machine.`

Прежде чем мы начнём, убедитесь, что у вас установлен tcpdump. Какую команду нужно использовать, чтобы проверить, установлен ли tcpdump в Linux?

##### **Нажмите, чтобы показать ответ**
Чтобы проверить, установлен ли у нас tcpdump, мы можем воспользоваться командой в Linux или нажать клавишу Windows и начать вводить tcpdump в Windows.

```shell-session
Barlogsha@htb[/htb]$ which tcpdump
```

---

#### Задача №2

`Start a capture.`

Теперь, когда мы знаем, что tcpdump установлен, мы можем приступить к первому захвату данных. Если мы не уверены, какие интерфейсы нужно прослушивать, мы можем воспользоваться встроенным переключателем, чтобы получить их список.

Какой переключатель tcpdump используется для отображения всех возможных интерфейсов, которые мы можем прослушивать?

##### **Нажмите, чтобы показать ответ**

`Step one`: Список интерфейсов для захвата.

```shell-session
Barlogsha@htb[/htb]$ tcpdump -D 
```

`Step two`: Начинайте наш захват.

```shell-session
Barlogsha@htb[/htb]$ tcpdump -i [interface name or #]
```

---

#### Задача №3

`Utilize Basic Capture Filters.`

Теперь, когда мы можем перехватывать трафик, давайте изменим способ представления этой информации. Для этого мы добавим детализацию в вывод и будем отображать содержимое в формате ASCII и Hex. Выполнив эту задачу, попробуйте снова использовать другие параметры.

Отключите разрешение имён и отображайте относительные порядковые номера для другого задания.

##### **Нажмите, чтобы показать ответ**

```shell-session
Barlogsha@htb[/htb]$ tcpdump -i [interface name or #] -vX
```

---

#### Задача №4

`Save a Capture to a .PCAP file.`

Теперь нам нужно решить, как мы хотим захватывать и просматривать выходные данные. Помните, что при использовании фильтров захвата они будут изменять то, что мы получаем. Сделайте первый полный захват с сетевого интерфейса и сохраните его в файл PCAP. Это будет образец для базовой настройки корпоративной сети.

##### **Нажмите, чтобы показать ответ**

```shell-session
Barlogsha@htb[/htb]$ tcpdump -i [interface name or #] -nvw [/path/of/filename.pcap]
```

---

#### Задание №5

`Read the Capture from a .PCAP file.`

Члены нашей команды предоставили нам PCAP-файл, который они захватили во время исследования другого подразделения компании. Мы прочитали PCAP-файл в tcpdump и изменили его представление, чтобы понять, что происходит. Для простоты мы можем отключить разрешение имён хостов и портов и убедиться, что видим абсолютные значения порядковых номеров TCP-последовательностей и подтверждений. Для этой задачи используйте PCAP-файл, который мы создали на предыдущем шаге.

##### **Нажмите, чтобы показать ответ**

```shell-session
Barlogsha@htb[/htb]$ tcpdump -nnSXr [file/to/read.pcap]
```

Приведённые выше переключатели не преобразуют имена хостов или номера портов, не применяют абсолютные порядковые номера и не отображают содержимое в шестнадцатеричном формате и формате ASCII при чтении из файла PCAP.

Выполнив вышеперечисленные задания, пожалуйста, ответьте на вопросы в конце раздела, чтобы проверить наше понимание.