#traffic #network #wireshark #htb #htb_lab 

Один из наших коллег-администраторов заметил странное подключение с хоста Боба `IP = 172.16.10.90` при анализе базовых данных, которые мы собирали. Он попросил нас проверить, что, по нашему мнению, происходит.

Попробуйте применить концепции из разделов «Процесс анализа» для выполнения анализа файла guided-analysis.zip, который находится в дополнительных ресурсах, а также для анализа реального трафика из сети академии. После выполнения задания в файле PCAP в архиве вы найдёте ключ для проверки своей работы.

---

## Задачи:

#### Задача №1

`Connect to the live host for capture.`

`Connection Instructions`Для доступа к лабораторной среде и выполнения следующих задач потребуется использовать [XfreeRDP](https://manpages.ubuntu.com/manpages/trusty/man1/xfreerdp.1.html) для предоставления графического интерфейса доступа к виртуальной машине, чтобы мы могли использовать Wireshark внутри среды.

Мы будем подключаться к лаборатории Академии в обычном режиме, используя вашу собственную виртуальную машину с VPN-ключом HTB Academy или Pwnbox, встроенным в раздел модуля. Вы можете запустить клиент FreeRDP на Pwnbox, введя в командной строке следующую команду после запуска цели:

Код: bash

```bash
xfreerdp /v:<target IP> /u:htb-student /p:HTB_@cademy_stdnt!
```

Вы можете найти `target IP`, `Username` и `Password` необходимые ниже:

- Нажмите ниже в разделе «Вопросы», чтобы создать целевой хост и получить IP-адрес.
    - `IP` ==
    - `Username` == htb-студент
    - `Password` == HTB_@cademy_stdnt!

После подключения откройте Wireshark и начните захват пакетов на интерфейсе ENS224.

---

### Анализ

Следуйте этому шаблону рабочего процесса и изучите подозрительный трафик. Цель — определить, что происходит с данным хостом.

1. в чём проблема?
    1. краткое изложение проблемы.
2. определите масштаб и цель (что мы ищем? в какой период времени?)
    1. Область поиска: что и где мы ищем?
    2. когда началась проблема:
    3. Дополнительная информация: файлы, источники данных, всё, что может быть полезно.
3. определите нашу цель (цели) (сеть / хост (хосты) / протокол)
    1. Целевые хосты: сеть или адрес хостов.
4. перехватывать сетевой трафик / считывать данные из ранее перехваченного PCAP.
    1. Выполняйте необходимые действия для анализа трафика на предмет признаков вторжения.
5. определение необходимых компонентов сетевого трафика (фильтрация)
    1. Как только мы получим данные о трафике, отфильтруем весь трафик, который не нужен для данного исследования, весь трафик, соответствующий нашим общим базовым показателям, и оставим только то, что имеет отношение к теме исследования.
6. Анализ перехваченного сетевого трафика
    1. После того как мы отфильтровали шум, пришло время искать наши цели. Начните с широкого круга и постепенно сужайте его вокруг области поиска.
7. составление заметок / интеллект-карт на основе найденных результатов.
    
    1. Очень важно фиксировать всё, что мы делаем, видим или находим в ходе расследования. Обязательно делайте подробные записи, в том числе:
    
    - Временные рамки, в которые мы фиксировали трафик.
    - Подозрительные хосты/порты в сети.
    - Разговоры, содержащие что-либо подозрительное. (включая временные метки, номера пакетов, файлы и т. д.)
8. краткое изложение результатов анализа (что мы обнаружили?)
    1. Наконец, подведите итог всему найденному и объясните важные детали, чтобы руководство могло принять решение о карантине для затронутых хостов или о более серьёзном реагировании на инцидент.
    2. Наш анализ повлияет на принимаемые решения, поэтому важно быть максимально ясным и кратким.

`Complete an attempt on your own first to examine and follow the workflow, then look below for a guided walkthrough of the lab.`

### **Нажмите, чтобы показать пошаговое руководство**

![Снимок экрана Wireshark, на котором показаны ARP- и TCP-пакеты между IP-адресами 10.129.43.4 и 10.129.43.29, а также статистика разговоров.](https://academy.hackthebox.com/storage/modules/81/guided-conversations.png)

![Статистика иерархии протоколов Wireshark, показывающая процентное соотношение и объём данных для различных протоколов, включая TCP и UDP.](https://academy.hackthebox.com/storage/modules/81/guided-proto.png)

![Wireshark capture showing ARP and NAT-PMP packets between VMware and IPs 10.129.43.4 and 10.129.0.1, including M-SEARCH and TCP requests.](https://academy.hackthebox.com/storage/modules/81/guided-udp.png)

![Wireshark capture showing TCP packets between IPs 10.129.43.4 and 10.129.43.29, filtered by UDP and ARP protocols.](https://academy.hackthebox.com/storage/modules/81/guided-tcp.png)

![Wireshark capture showing TCP packets between IPs 10.129.43.4 and 10.129.43.29, with sequence and acknowledgment details.](https://academy.hackthebox.com/storage/modules/81/guided-handshake.png)

![Command prompt showing Windows version, IP configuration, directory listing, and user creation commands.](https://academy.hackthebox.com/storage/modules/81/guided-stream.png)

---

## Краткие сведения

Проанализировав предпринятые действия, команда реагирования на инциденты установила, что злоумышленник поленился и решил использовать оболочку Netcat для прямого взаимодействия с хостом Боба, попутно собирая дополнительную информацию. При этом он использовал RDP-подключение с хоста Боба к другому рабочему столу Windows в той же среде, чтобы попытаться закрепиться там. К счастью, команда реагирования на инциденты смогла перехватить часть трафика RDP. Хост-система Боба была помещена в карантин, и были приняты меры по реагированию на инцидент, чтобы определить, что было украдено и какие другие потенциальные хост-системы были скомпрометированы. Отличная работа по выявлению вторжения.