#linux #htb 

Системные журналы в Linux — это набор файлов, содержащих информацию о системе и выполняемых в ней действиях. Эти журналы важны для мониторинга и устранения неполадок в системе, поскольку они могут дать представление о поведении системы, работе приложений и событиях, связанных с безопасностью. Эти системные журналы также могут быть ценным источником информации для выявления потенциальных слабых мест и уязвимостей в системе Linux. Анализируя журналы событий в целевых системах, мы можем получить представление о поведении системы, сетевой активности и действиях пользователей и использовать эту информацию для выявления любых аномальных действий, таких как несанкционированные логины, попытки атак, учётные данные в открытом виде или необычный доступ к файлам, которые могут указывать на потенциальное нарушение безопасности.

Мы, специалисты по тестированию на проникновение, также можем использовать системные журналы для отслеживания эффективности наших действий по тестированию безопасности. Изучая журналы после тестирования безопасности, мы можем определить, вызвали ли наши действия какие-либо события, связанные с безопасностью, например, оповещения об обнаружении вторжений или системные предупреждения. Эта информация может помочь нам усовершенствовать наши стратегии тестирования и повысить общую безопасность системы.

Чтобы обеспечить безопасность системы Linux, важно правильно настроить системные журналы. Это включает в себя установку соответствующих уровней ведения журналов, настройку ротации журналов, чтобы файлы журналов не становились слишком большими, а также обеспечение безопасного хранения журналов и защиту от несанкционированного доступа. Кроме того, важно регулярно просматривать и анализировать журналы, чтобы выявлять потенциальные угрозы безопасности и своевременно реагировать на любые события, связанные с безопасностью. В Linux существует несколько различных типов системных журналов, в том числе:

- Журналы ядра
- Системные журналы
- Журналы аутентификации
- Журналы приложений
- Журналы безопасности

#### Журналы ядра

Эти журналы содержат информацию о ядре системы, в том числе об аппаратных драйверах, системных вызовах и событиях ядра. Они хранятся в файле `/var/log/kern.log`. Например, журналы ядра могут указывать на наличие уязвимых или устаревших драйверов, которые могут быть использованы злоумышленниками для получения доступа к системе. Они также могут давать представление о сбоях системы, ограничениях ресурсов и других событиях, которые могут привести к отказу в обслуживании или другим проблемам с безопасностью. Кроме того, журналы ядра могут помочь нам выявить подозрительные системные вызовы или другие действия, которые могут указывать на наличие вредоносного или другого нежелательного программного обеспечения в системе. Наблюдая за файлом `/var/log/kern.log`, мы можем обнаружить любое необычное поведение и принять соответствующие меры для предотвращения дальнейшего повреждения системы.

#### Системные журналы

Эти журналы содержат информацию о событиях системного уровня, таких как запуск и остановка служб, попытки входа в систему и перезагрузка системы. Они хранятся в файле `/var/log/syslog`. Анализируя попытки входа в систему, запуск и остановку служб и другие события системного уровня, мы можем обнаружить любой возможный доступ или действия в системе. Это может помочь нам выявить уязвимости, которыми можно воспользоваться, и порекомендовать меры безопасности для снижения этих рисков. Кроме того, мы можем использовать `syslog` для выявления потенциальных проблем, которые могут повлиять на доступность или производительность системы, например, неудачные запуски служб или перезагрузки системы. Вот пример того, как может выглядеть такой файл `syslog`:

#### Системный журнал

  Системные журналы

```shell-session
Feb 28 2023 15:00:01 server CRON[2715]: (root) CMD (/usr/local/bin/backup.sh)
Feb 28 2023 15:04:22 server sshd[3010]: Failed password for htb-student from 10.14.15.2 port 50223 ssh2
Feb 28 2023 15:05:02 server kernel: [  138.303596] ata3.00: exception Emask 0x0 SAct 0x0 SErr 0x0 action 0x6 frozen
Feb 28 2023 15:06:43 server apache2[2904]: 127.0.0.1 - - [28/Feb/2023:15:06:43 +0000] "GET /index.html HTTP/1.1" 200 13484 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36"
Feb 28 2023 15:07:19 server sshd[3010]: Accepted password for htb-student from 10.14.15.2 port 50223 ssh2
Feb 28 2023 15:09:54 server kernel: [  367.543975] EXT4-fs (sda1): re-mounted. Opts: errors=remount-ro
Feb 28 2023 15:12:07 server systemd[1]: Started Clean PHP session files.
```

#### Журналы аутентификации

Эти журналы содержат информацию о попытках аутентификации пользователя, включая успешные и неудачные попытки. Они хранятся в `/var/log/auth.log` файле. Важно отметить, что, хотя `/var/log/syslog` файл может содержать аналогичную информацию для входа, `/var/log/auth.log` файл специально фокусируется на попытках аутентификации пользователя, что делает его более ценным ресурсом для выявления потенциальных угроз безопасности. Поэтому специалистам по тестированию на проникновение важно просмотреть журналы, хранящиеся в `/var/log/auth.log` файле, чтобы убедиться, что система безопасна и не была скомпрометирована.

#### Auth.log

  Системные журналы

```shell-session
Feb 28 2023 18:15:01 sshd[5678]: Accepted publickey for admin from 10.14.15.2 port 43210 ssh2: RSA SHA256:+KjEzN2cVhIW/5uJpVX9n5OB5zVJ92FtCZxVzzcKjw
Feb 28 2023 18:15:03 sudo:   admin : TTY=pts/1 ; PWD=/home/admin ; USER=root ; COMMAND=/bin/bash
Feb 28 2023 18:15:05 sudo:   admin : TTY=pts/1 ; PWD=/home/admin ; USER=root ; COMMAND=/usr/bin/apt-get install netcat-traditional
Feb 28 2023 18:15:08 sshd[5678]: Disconnected from 10.14.15.2 port 43210 [preauth]
Feb 28 2023 18:15:12 kernel: [  778.941871] firewall: unexpected traffic allowed on port 22
Feb 28 2023 18:15:15 auditd[9876]: Audit daemon started successfully
Feb 28 2023 18:15:18 systemd-logind[1234]: New session 4321 of user admin.
Feb 28 2023 18:15:21 CRON[2345]: pam_unix(cron:session): session opened for user root by (uid=0)
Feb 28 2023 18:15:24 CRON[2345]: pam_unix(cron:session): session closed for user root
```

В этом примере в первой строке мы видим, что для аутентификации пользователя `admin` успешно использован открытый ключ. Кроме того, мы видим, что этот пользователь входит в группу `sudoers`, поскольку он может выполнять команды с помощью `sudo`. Сообщение ядра указывает на то, что на порту 22 был разрешён неожиданный трафик, что может указывать на потенциальное нарушение безопасности. После этого мы видим, что для пользователя «admin» `systemd-logind` был создан новый сеанс, а для пользователя `cron` был открыт и закрыт сеанс `root`.

#### Журналы приложений

Эти журналы содержат информацию о действиях конкретных приложений, запущенных в системе. Они часто хранятся в своих собственных файлах, таких как `/var/log/apache2/error.log` для веб-сервера Apache или `/var/log/mysql/error.log` для сервера баз данных MySQL. Эти журналы особенно важны, когда мы ориентируемся на конкретные приложения, такие как веб-серверы или базы данных, поскольку они могут дать представление о том, как эти приложения обрабатывают данные. Изучая эти журналы, мы можем выявить потенциальные уязвимости или неправильные настройки. Например, журналы доступа можно использовать для отслеживания запросов, отправляемых на веб-сервер, а журналы аудита — для отслеживания изменений, вносимых в систему или в отдельные файлы. Эти журналы можно использовать для выявления попыток несанкционированного доступа, утечки данных или других подозрительных действий.

Кроме того, журналы доступа и аудита — это важные журналы, в которых записывается информация о действиях пользователей и процессов в системе. Они имеют решающее значение для обеспечения безопасности и соответствия требованиям, и мы можем использовать их для выявления потенциальных проблем с безопасностью и векторов атак.

Например, `access logs` ведёт журнал действий пользователей и процессов в системе, включая попытки входа в систему, доступ к файлам и сетевые подключения. `Audit logs` записывает информацию о событиях в системе, связанных с безопасностью, таких как изменения в файлах конфигурации системы или попытки изменить системные файлы или настройки. Эти журналы помогают отслеживать потенциальные атаки и действия, а также выявлять нарушения безопасности и другие проблемы. Пример записи в журнале доступа может выглядеть следующим образом:

#### Запись в журнале доступа

  Системные журналы

```shell-session
2023-03-07T10:15:23+00:00 servername privileged.sh: htb-student accessed /root/hidden/api-keys.txt
```

В этой записи журнала мы видим, что пользователь `htb-student` использовал скрипт `privileged.sh` для доступа к файлу `api-keys.txt` в каталоге `/root/hidden/`. В системах Linux журналы доступа большинства распространённых служб по умолчанию хранятся в следующих местах:

|**Обслуживание**|**Описание**|
|---|---|
|`Apache`|Журналы доступа хранятся в файле /var/log/apache2/access.log (или аналогичном, в зависимости от дистрибутива).|
|`Nginx`|Журналы доступа хранятся в файле /var/log/nginx/access.log (или аналогичном).|
|`OpenSSH`|Журналы доступа хранятся в файле /var/log/auth.log в Ubuntu и в /var/log/secure в CentOS/RHEL.|
|`MySQL`|Журналы доступа хранятся в файле /var/log/mysql/mysql.log.|
|`PostgreSQL`|Журналы доступа хранятся в файле /var/log/postgresql/postgresql-version-main.log.|
|`Systemd`|Журналы доступа хранятся в каталоге /var/log/journal/.|

#### Журналы безопасности

Эти журналы безопасности и связанные с ними события часто записываются в различные файлы журналов в зависимости от конкретного используемого приложения или инструмента безопасности. Например, приложение Fail2ban записывает неудачные попытки входа в систему в файл `/var/log/fail2ban.log`, а брандмауэр UFW записывает активность в файл `/var/log/ufw.log`. Другие события, связанные с безопасностью, например изменения в системных файлах или настройках, могут записываться в более общие системные журналы, такие как `/var/log/syslog` или `/var/log/auth.log`. Как специалисты по тестированию на проникновение, мы можем использовать инструменты и методы анализа журналов для поиска конкретных событий или закономерностей в действиях, которые могут указывать на проблемы с безопасностью, и использовать эту информацию для дальнейшего тестирования системы на наличие уязвимостей или потенциальных векторов атак.

Важно знать, где по умолчанию хранятся журналы доступа и другие файлы журналов в системах Linux, поскольку эта информация может быть полезна при оценке безопасности или тестировании на проникновение. Понимая, как записываются и хранятся события, связанные с безопасностью, мы можем более эффективно анализировать данные журналов и выявлять потенциальные проблемы с безопасностью.

Ко всем этим журналам можно получить доступ и проанализировать их с помощью различных инструментов, в том числе средств просмотра журналов, встроенных в большинство настольных сред Linux, а также инструментов командной строки, таких как команды `tail`, `grep`, и `sed`. Правильный анализ системных журналов может помочь выявить и устранить проблемы в системе, а также обнаружить нарушения безопасности и другие интересующие вас события.