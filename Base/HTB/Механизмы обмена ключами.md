#network #htb #crypto

Методы обмена ключами используются для безопасного обмена [криптографическими ключами](https://www.cloudflare.com/learning/ssl/what-is-a-cryptographic-key/) между двумя сторонами. Это неотъемлемая часть многих криптографических протоколов, поскольку безопасность шифрования, используемого для защиты связи, зависит от секретности ключей. Существует множество методов обмена ключами, каждый из которых обладает уникальными характеристиками и преимуществами. Некоторые методы обмена ключами более безопасны, чем другие, и выбор подходящего метода зависит от конкретных обстоятельств и требований.

Эти методы обычно работают следующим образом: обе стороны договариваются о `shared secret key` использовании небезопасного канала связи, который шифрует обмен данными между ними. Как правило, это делается с помощью какой-либо математической операции, например вычисления на основе свойств математической функции или ряда простых манипуляций с ключом.

#### Диффи-Хеллман

Одним из распространённых методов обмена ключами является [обмен ключами Диффи — Хеллмана](https://www.comparitech.com/blog/information-security/diffie-hellman-key-exchange/), который позволяет двум сторонам договориться об общем секретном ключе без какой-либо предварительной связи или обмена личной информацией. Он основан на концепции, согласно которой две стороны генерируют общий секретный ключ, который можно использовать для шифрования и расшифровки сообщений между ними. Он часто используется в качестве основы для создания безопасных каналов связи, например в [протоколе безопасности транспортного уровня](https://www.cloudflare.com/learning/ssl/transport-layer-security-tls/) (`TLS`), который применяется для защиты веб-трафика.

Одним из основных недостатков `Diffie-Hellman` обмена ключами является его уязвимость перед `MITM attacks`. При атаке посредника мы перехватываем обмен данными между двумя сторонами и выдаём себя за одну из них, генерируя другой секретный ключ и обманом заставляя обе стороны использовать его. Это позволяет злоумышленнику читать и изменять сообщения, которыми обмениваются стороны.

Ещё одним ограничением является то, что для генерации общего секретного ключа требуется относительно большое количество `CPU power`. Это может сделать его использование нецелесообразным на устройствах с низким энергопотреблением или в ситуациях, когда ключ нужно сгенерировать быстро.

#### RSA

Другим методом обмена ключами является [алгоритм Ривеста — Шамира — Адлемана](https://web.archive.org/web/20240302211950/https://venafi.com/blog/how-diffie-hellman-key-exchange-different-rsa/) (`RSA`), который использует свойства больших простых чисел для создания общего секретного ключа. Этот метод основан на том, что относительно легко перемножить большие простые числа, но сложно разложить полученное число на простые множители. Помимо этих двух методов, есть ещё несколько, которые нам нужно рассмотреть. Он также широко используется во многих других приложениях и протоколах, требующих безопасной связи и защиты данных, в том числе, но не ограничиваясь этим:

- Шифрование и подписание сообщений для обеспечения конфиденциальности и аутентификации
    
- Защита данных при передаче по сетям, например в [уровне защищенных сокетов](https://www.cloudflare.com/learning/ssl/what-is-ssl/) (`SSL`) и `TLS`
    
- Создание и проверка цифровых подписей, которые используются для подтверждения подлинности и целостности электронных документов и других цифровых данных
    
- Аутентификация пользователей и устройств, например, в протоколе [Криптография с открытым ключом для начальной аутентификации в Kerberos](https://www.ietf.org/rfc/rfc4556.txt) (`PKINIT`), используемом системой сетевой аутентификации Kerberos
    
- Защита конфиденциальной информации, например шифрование персональных данных и секретных документов
    

#### ECDH

[Диффи-Хеллман на эллиптических кривых](https://medium.com/swlh/understanding-ec-diffie-hellman-9c07be338d4a) (`ECDH`) — это вариант обмена ключами Диффи-Хеллмана, в котором для генерации общего секретного ключа используется криптография на эллиптических кривых. Его преимущество в том, что он более эффективен и безопасен, чем оригинальный алгоритм Диффи-Хеллмана, в том числе благодаря:

- Создание безопасных каналов связи, например, по протоколу `TLS`
    
- Обеспечение прямой секретности, которая гарантирует, что прошлые сообщения не будут раскрыты, даже если приватные ключи будут скомпрометированы
    
- Аутентификация пользователей и устройств, например, по протоколу [Internet Key Exchange](https://docs.oracle.com/cd/E19683-01/816-7264/6md9iem1g/index.html) (`IKE`), используемому в VPN
    

#### ECDSA

[Алгоритм цифровой подписи на основе эллиптических кривых](https://www.hypr.com/security-encyclopedia/elliptic-curve-digital-signature-algorithm) (`ECDSA`) использует криптографию на основе эллиптических кривых для создания цифровых подписей, которые могут подтвердить подлинность сторон, участвующих в обмене ключами.

Давайте обобщим и сравним эти алгоритмы:

|**Алгоритм**|**Аббревиатура**|**Безопасность**|
|---|---|---|
|`Diffie-Hellman`|`DH`|Относительно безопасно и эффективно с точки зрения вычислений|
|`Rivest–Shamir–Adleman`|`RSA`|Широко используется и считается безопасным, но требует больших вычислительных мощностей|
|`Elliptic Curve Diffie-Hellman`|`ECDH`|Обеспечивает более высокий уровень безопасности по сравнению с традиционным протоколом Диффи — Хеллмана|
|`Elliptic Curve Digital Signature Algorithm`|`ECDSA`|Обеспечивает повышенную безопасность и эффективность при создании цифровой подписи|

---

## Internet Key Exchange

[Internet Key Exchange](https://www.hypr.com/security-encyclopedia/internet-key-exchange) (`IKE`) — это протокол, используемый для установления и поддержания безопасных сеансов связи, например в VPN. Он использует комбинацию `Diffie-Hellman` алгоритма обмена ключами и `other cryptographic techniques` для безопасного обмена ключами и согласования параметров безопасности. Кроме того, он является ключевым компонентом многих VPN-решений, поскольку обеспечивает безопасный обмен ключами и другой информацией о безопасности между клиентом и сервером VPN. Это позволяет VPN-клиенту и серверу устанавливать зашифрованный туннель для безопасной передачи данных.

IKE можно использовать и для других целей, например для аутентификации пользователей и устройств. Обычно он используется в сочетании с другими протоколами и алгоритмами, такими как алгоритм RSA для обмена ключами и создания цифровых подписей, а также [расширенный стандарт шифрования](https://www.geeksforgeeks.org/advanced-encryption-standard-aes/) (`AES`) для шифрования данных.

IKE работает в режимах `main mode` или `aggressive mode`. Эти режимы определяют последовательность и параметры процесса обмена ключами и могут влиять на безопасность и производительность сеанса IKE.

#### Основной режим

`main mode` — это режим по умолчанию для `IKE` и, как правило, считается `more secure` более безопасным, чем агрессивный режим. Процесс обмена ключами выполняется в `three phases` в основном режиме, при этом каждый раз происходит обмен другим набором параметров безопасности и ключей. Это обеспечивает большую гибкость и безопасность, но может привести к снижению производительности по сравнению с агрессивным режимом.

#### Агрессивный режим

`Aggressive mode` Это альтернативный режим для `IKE`, который обеспечивает `faster performance` за счёт сокращения количества циклов и обменов сообщениями, необходимых для обмена ключами. В этом режиме процесс обмена ключами выполняется в `two phases`, при этом все параметры безопасности и ключи обмениваются на первом этапе. Однако это может повысить производительность, но также снизить безопасность сеанса IKE по сравнению с основным режимом, поскольку `aggressive mode` не обеспечивает защиту идентификационных данных.

#### Предварительно разделенные ключи

В IKE `Pre-Shared Key` (`PSK`) — это секретное значение, которым обмениваются две стороны, участвующие в обмене ключами. Этот ключ используется для аутентификации сторон и создания общего секрета, который шифрует последующую передачу данных. Использование PSK в IKE необязательно, и решение о его использовании зависит от конкретных требований и ограничений в данной ситуации. Однако если `PSK` используется, то перед началом процесса обмена ключами он должен быть надёжно передан между двумя сторонами. Это можно сделать с помощью защищенного внеполосного канала, например отдельного канала связи, или путем физического обмена ключами.

Основное преимущество использования PSK заключается в том, что он обеспечивает дополнительный уровень безопасности, позволяя сторонам проходить аутентификацию друг у друга. Однако использование PSK имеет свои ограничения и недостатки. Например, может быть затруднена безопасная передача ключа, а если ключ будет скомпрометирован в результате атаки посредника, то может быть нарушена безопасность сеанса IKE.

