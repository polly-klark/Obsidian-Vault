#AD #htb #htb_lab #windows 

В этом разделе обучающей лаборатории мы выполним последние задания на сегодня. Нам нужно добавить компьютер в домен и изменить подразделение, в котором он находится.

---

## Инструкции по подключению

В этой лабораторной работе вы будете использовать RDP и получите доступ к хосту Windows, не присоединённому к домену, с которого вы сможете выполнять любые действия, необходимые для выполнения лабораторной работы. Вы будете использовать RDP-подключение, как и в первой части.

- Нажмите ниже в разделе «Вопросы», чтобы создать целевой хост и получить IP-адрес.
    - IP ==
    - Имя пользователя == `image`
    - Пароль == `Academy_student_AD!`

---

## Задание 4. Добавление и удаление компьютеров из домена

Нашим новым пользователям понадобятся компьютеры для выполнения повседневных задач. Служба поддержки только что завершила их настройку и просит нас добавить их в домен INLANEFREIGHT. Поскольку эти должности аналитиков появились недавно, нам нужно убедиться, что после присоединения к домену хосты окажутся в нужном подразделении, чтобы групповая политика работала должным образом.

Хост, который нам нужно подключить к домену INLANEFREIGHT, называется `ACADEMY-IAD-W10` и имеет следующие учётные данные для входа и завершения процесса подготовки:

- Пользователь == `image`
- Пароль == `Academy_student_AD!`

Получив доступ к хосту, используйте свою учётную запись `htb-student_adm`: `Academy_student_DA!` для присоединения хоста к домену.

### `Solution: Task 4`

Чтобы добавить локальный хост в домен с помощью PowerShell, откройте сеанс PowerShell от имени администратора и введите следующую команду:

#### PowerShell Присоединяется к домену

```powershell-session
PS C:\htb> Add-Computer -DomainName INLANEFREIGHT.LOCAL -Credential INLANEFREIGHT\HTB-student_adm -Restart
```

В этой строке используется `domain` (INLANEFREIGHT.LOCAL), к которому мы хотим присоединить хост, и мы должны указать `user` учётные данные, которые мы будем использовать для авторизации при присоединении. (HTB-student_ADM). Указание перезапуска в строке необходимо, поскольку присоединение произойдёт только после перезапуска хоста, что позволит ему получить настройки и политики из домена.

#### Добавление через графический интерфейс

Чтобы добавить компьютер в домен из графического интерфейса localhost, нужно сделать немного другое. Выполните следующие действия, чтобы присоединить его к домену:

- На компьютере, к которому вы хотите присоединиться к домену, откройте `Control Panel` и перейдите в раздел "Система и безопасность" > "Система".
- Теперь выберите значок «Изменить настройки» в разделе `Computer name`. Появится ещё одно диалоговое окно, в котором потребуется ввести учётные данные администратора. В следующем окне нужно выбрать значок изменения рядом с надписью «Чтобы переименовать этот компьютер или изменить его домен или рабочую группу, нажмите «Изменить»». Откроется ещё одно окно, в котором можно изменить имя компьютера, домен и рабочую группу. Перед присоединением убедитесь, что имя компьютера соответствует стандарту именования, который вы хотите использовать для домена. Это облегчит административную нагрузку, связанную с последующим переименованием хоста, присоединённого к домену.
- Далее нам нужно ввести имя домена, к которому мы хотим присоединить компьютер (`INLANEFREIGHT.LOCAL`), и нажать «ОК» . Вы можете получить предупреждение о разрешении имён NetBIOS. Эта проблема выходит за рамки данной лабораторной работы. А пока двигаемся дальше.
    - Для выполнения этого действия вам будет предложено ввести учетные данные домена. Используйте учетную запись администратора домена, которую вам предоставили в начале работы над этим лабораторным заданием. (`htb-student_adm`).
    - Если всё пройдёт успешно, вы увидите сообщение с приветствием домена. Для применения изменений и новых настроек групповой политики, которые компьютер получит от домена, требуется перезагрузка.

## Добавление компьютера в домен

Мы собираемся использовать графический интерфейс Windows, чтобы добавить этот компьютер в домен.

1. В панели управления откройте свойства системы для компьютера. Нажмите «Изменить параметры» в разделе «Имя компьютера».

![[Pasted image 20251030180623.png]]

2. В этом окне нажмите кнопку «Изменить» рядом с пунктом «Переименовать этот компьютер или изменить его домен».

![[Pasted image 20251030180638.png]]

3. Введите домен, к которому вы хотите присоединить хост (INLANEFREIGHT.LOCAL). Нажмите «ОК».

![[Pasted image 20251030180724.png]]

4. Введите учётные данные администратора домена, необходимые для присоединения хоста к домену.

![[Pasted image 20251030180911.png]]

5. Если всё пройдёт успешно, вы увидите всплывающее окно с сообщением «Добро пожаловать в домен».

![[Pasted image 20251030180924.png]]

#### Добавление удалённого компьютера в домен

```powershell-session
PS C:\htb> Add-Computer -ComputerName ACADEMY-IAD-W10 -LocalCredential ACADEMY-IAD-W10\image -DomainName INLANEFREIGHT.LOCAL -Credential INLANEFREIGHT\htb-student_adm -Restart
```

Когда мы добавляли компьютер в домен, мы не создавали для него объект AD в том подразделении, в котором он должен был находиться, поэтому теперь нам нужно переместить его в нужное подразделение. Чтобы сделать это с помощью PowerShell:

#### Проверьте членство в подразделении

```powershell-session
PS C:\htb> Get-ADComputer -Identity "ACADEMY-IAD-W10" -Properties * | select CN,CanonicalName,IPv4Address
```

Свойство CanonicalName (см. выше) сообщает нам полный путь к хосту, выводя имя в формате «Домен/OU/Имя». Мы можем использовать его, чтобы найти хост и проверить, где он находится в нашей структуре AD.

С помощью оснастки ADUC вы также можете довольно быстро перемещать компьютерные объекты. Для этого выполните следующие действия:

#### Добавить в новую группу

## Перемещение компьютерного объекта в новую организационную единицу

Нам нужно найти нового хоста и переместить его в подразделение «Аналитики безопасности» так же, как мы ранее переместили учётную запись пользователя.

1. В подразделении «Компьютеры» выберите только что подключённый хост и щёлкните по нему правой кнопкой мыши. Выберите опцию «Переместить»

![[Pasted image 20251030180953.png]]

2. Во всплывающем окне перейдите к подразделению «Аналитики безопасности».

![[Pasted image 20251030181015.png]]

3. Выберите подразделение «Аналитики безопасности» и нажмите «ОК».

![[Pasted image 20251030181029.png]]

4. Если мы заглянем в этот подраздел, то увидим внутри новый объект «Компьютер».

![[Pasted image 20251030181045.png]]

## Краткие сведения

На этом наши административные обязанности на сегодня завершены. Надеюсь, эта лаборатория помогла вам закрепить базовые понятия, связанные с управлением Active Directory. Всегда полезно получить практический опыт работы с такими темами и технологиями, как Active Directory. Этот опыт поможет вам лучше понять, как она функционирует и какие преимущества можно извлечь из её использования. Каждый день появляются новые уязвимости и атаки, затрагивающие операционную систему Windows и, соответственно, Active Directory. Фундаментальное понимание Active Directory, атак, которым она подвергается, и защитных мер поможет нам как специалистам по безопасности.

Примечание. Создание целевого экземпляра может занять 2–3 минуты. Если при попытке подключения через RDP вы получаете сообщение об ошибке `Timeout waiting for activation`, подождите несколько секунд и повторите команду. Кроме того, при первом запуске загрузка модуля Active Directory PowerShell или оснасток MMC может занять немного больше времени.