#AD #htb #windows 

При работе с AD мы часто будем сталкиваться с термином «объекты». Что такое объект? Объект можно определить как ЛЮБОЙ ресурс, присутствующий в среде Active Directory, например организационные подразделения, принтеры, пользователи, контроллеры домена.

#### Объекты AD

![[Pasted image 20250907181247.png]]

#### Пользователи

Это пользователи в среде AD организации. Пользователи считаются `leaf objects`, то есть они не могут содержать в себе другие объекты. Другим примером конечного объекта является почтовый ящик в Microsoft Exchange. Объект пользователя считается субъектом безопасности и имеет идентификатор безопасности (SID) и глобальный уникальный идентификатор (GUID). Объекты пользователей имеют множество возможных [атрибутов](http://www.kouti.com/tables/userattributes.htm), таких как отображаемое имя, время последнего входа в систему, дата последнего изменения пароля, адрес электронной почты, описание учетной записи, администратор, адрес и многое другое. В зависимости от того, как настроена конкретная среда Active Directory, может существовать более 800 возможных атрибутов пользователя, если учитывать ВСЕ возможные атрибуты, как описано [здесь](https://www.easy365manager.com/how-to-get-all-active-directory-user-object-attributes/). Этот пример выходит далеко за рамки того, что обычно заполняется для стандартного пользователя в большинстве сред, но демонстрирует масштаб и сложность Active Directory. Они являются важной целью для злоумышленников, поскольку получение доступа даже к пользователю с ограниченными правами может обеспечить доступ ко многим объектам и ресурсам и позволить провести детальную перепись всего домена (или леса).

#### Контакты

Объект контакта обычно используется для представления внешнего пользователя и содержит информационные атрибуты, такие как имя, фамилия, адрес электронной почты, номер телефона и т.д. Они являются `leaf objects` и НЕ являются участниками безопасности (защищаемыми объектами), поэтому у них нет SID, только GUID. Примером может служить карточка контакта стороннего поставщика или клиента.

#### Принтеры

Объект «принтер» указывает на принтер, доступный в сети AD. Как и контакт, принтер является `leaf object` объектом, а не субъектом безопасности, поэтому у него есть только идентификатор GUID. Принтеры имеют такие атрибуты, как имя принтера, информация о драйвере, номер порта и т. д.

#### Компьютеры

Компьютерный объект - это любой компьютер, подключенный к сети AD (рабочая станция или сервер). Компьютеры являются таковыми `leaf objects` потому что они не содержат других объектов. Однако они считаются участниками системы безопасности и имеют SID и GUID. Как и пользователи, они являются основными целями для злоумышленников, поскольку полный административный доступ к компьютеру (в качестве всемогущей `NT AUTHORITY\SYSTEM` учетной записи) предоставляет аналогичные права обычному пользователю домена и может использоваться для выполнения большинства задач перечисления, которые может выполнять учетная запись пользователя (за исключением нескольких исключений в рамках доверенных доменов).

#### Общие папки

Объект общей папки указывает на общую папку на конкретном компьютере, на котором она находится. К общим папкам может применяться строгий контроль доступа. Они могут быть доступны всем (даже тем, у кого нет действующей учётной записи AD), только аутентифицированным пользователям (это означает, что любой пользователь с минимальными привилегиями или учётная запись компьютера (`NT AUTHORITY\SYSTEM`) могут получить к ней доступ) или заблокированы для доступа определённых пользователей/групп. Всем, кому явно не разрешён доступ, будет отказано в просмотре списка или содержимого. Общие папки НЕ являются субъектами безопасности и имеют только идентификатор GUID. Атрибуты общей папки могут включать в себя имя, расположение в системе, права доступа.

#### Группы

Группа считается a `container object` потому что она может содержать другие объекты, включая пользователей, компьютеры и даже другие группы. Группа рассматривается как участник безопасности и имеет SID и GUID. В AD группы - это способ управления разрешениями пользователей и доступом к другим защищаемым объектам (как пользователям, так и компьютерам). Допустим, мы хотим предоставить 20 пользователям службы поддержки доступ к группе пользователей удаленного управления на узле перехода. Вместо того чтобы добавлять пользователей одного за другим, мы могли бы добавить группу, и пользователи унаследовали бы предполагаемые разрешения через свое членство в группе. В Active Directory мы обычно видим так называемые "[вложенные группы](https://docs.microsoft.com/en-us/windows/win32/ad/nesting-a-group-in-another-group)" (группа, добавленная как член другой группы), что может привести к получению пользователем (ами) непреднамеренных прав. Членство во вложенных группах - это то, что мы видим и часто используем при тестировании на проникновение. Инструмент [BloodHound](https://github.com/BloodHoundAD/BloodHound) помогает обнаруживать пути атак в сети и иллюстрировать их в графическом интерфейсе. Он отлично подходит для аудита членства в группах и выявления/наблюдения за иногда непреднамеренными последствиями вложенного членства в группах. Группы в AD могут иметь множество [атрибуты](http://www.selfadsi.org/group-attributes.htm), наиболее распространёнными из которых являются название, описание, состав и другие группы, к которым принадлежит группа. Можно задать множество других атрибутов, о которых мы подробнее поговорим позже в этом модуле.

#### Организационные подразделения (ОП)

Организационная единица, или далее просто «организационная единица», — это контейнер, который системные администраторы могут использовать для хранения схожих объектов в целях упрощения администрирования. Организационные единицы часто используются для делегирования административных задач без предоставления пользователю полных административных прав. Например, у нас может быть организационная единица верхнего уровня под названием «Сотрудники», а под ней — дочерние организационные единицы для различных отделов, таких как маркетинг, отдел кадров, финансовый отдел, служба поддержки и т. д. Если бы учетной записи было предоставлено право сбрасывать пароли в подразделении верхнего уровня, этот пользователь имел бы право сбрасывать пароли для всех пользователей компании. Однако если бы структура подразделения была такой, что определенные отделы были бы дочерними подразделениями службы поддержки, то любому пользователю, находящемуся в подразделении службы поддержки, было бы делегировано это право. Другие задачи, которые можно делегировать на уровне подразделения, включают создание/удаление пользователей, изменение состава групп, управление ссылками на групповую политику и сброс паролей. Организационные единицы очень полезны для управления настройками групповой политики (которые мы рассмотрим позже в этом модуле) для подмножества пользователей и групп в домене. Например, мы можем захотеть установить определённую политику паролей для привилегированных учётных записей служб, чтобы эти учётные записи можно было поместить в определённое подразделение, а затем назначить ему объект групповой политики, который будет применять эту политику паролей ко всем учётным записям в этом подразделении. К атрибутам подразделения относятся его имя, участники, параметры безопасности и многое другое.

#### Домен

Домен — это структура сети Active Directory. Домены содержат такие объекты, как пользователи и компьютеры, которые организованы в контейнерные объекты: группы и организационные подразделения. У каждого домена есть собственная база данных и набор политик, которые можно применять ко всем объектам в домене. Некоторые политики установлены по умолчанию (и их можно настроить), например политика паролей домена. Другие политики создаются и применяются в зависимости от потребностей организации, например для блокировки доступа к cmd.exe для всех пользователей, не являющихся администраторами, или для сопоставления общих дисков при входе в систему.

#### Контроллеры домена

Контроллеры домена — это, по сути, «мозги» сети AD. Они обрабатывают запросы на аутентификацию, проверяют пользователей в сети и контролируют, кто может получить доступ к различным ресурсам домена. Все запросы на доступ проверяются контроллером домена, а привилегированные запросы на доступ основаны на заранее заданных ролях, назначенных пользователям. Контроллер домена также обеспечивает соблюдение политик безопасности и хранит информацию обо всех остальных объектах домена.

#### Сайты

Сайт в AD — это набор компьютеров в одной или нескольких подсетях, соединённых высокоскоростными каналами. Они используются для эффективной репликации между контроллерами домена.

#### Встроенный

В AD встроенный контейнер — это контейнер, в котором хранятся [группы по умолчанию](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups) в домене AD. Они создаются по умолчанию при создании домена AD.

#### Иностранные руководители Службы безопасности

Внешний участник безопасности (FSP) - это объект, созданный в AD для представления участника безопасности, который принадлежит доверенному внешнему лесу. Они создаются, когда объект, такой как пользователь, группа или компьютер из внешнего (за пределами текущего) леса, добавляется в группу в текущем домене. Они создаются автоматически после добавления участника безопасности в группу. Каждый внешний участник безопасности является объектом-заполнителем, который содержит SID внешнего объекта (объекта, принадлежащего другому лесу). Windows использует этот идентификатор безопасности для разрешения имени объекта через доверительные отношения. FSP создаются в специальном контейнере с именем ForeignSecurityPrincipals и отличительным именем, например `cn=ForeignSecurityPrincipals,dc=inlanefreight,dc=local`.