#htb #linux 

В Linux права доступа назначаются пользователям и группам. Каждый пользователь может быть членом разных групп, и членство в этих группах даёт пользователю дополнительные права. Каждый файл и каталог принадлежат определённому пользователю и определённой группе. Таким образом, права доступа для пользователей и групп, которые определили файл, также определены для соответствующих владельцев. Когда мы создаём новые файлы или каталоги, они принадлежат группе, к которой мы принадлежим, и нам.

Когда пользователь хочет получить доступ к содержимому каталога Linux, он должен сначала перейти в этот каталог, что означает переход в этот каталог, для чего пользователю требуются `execute` разрешения на доступ к каталогу. Без этих разрешений пользователь не сможет получить доступ к содержимому каталога и вместо этого увидит сообщение об ошибке «`Permission Denied`».

  Управление разрешениями

```shell-session
cry0l1t3@htb[/htb]$ ls -l

drw-rw-r-- 3 cry0l1t3 cry0l1t3   4096 Jan 12 12:30 scripts


cry0l1t3@htb[/htb]$ ls -al mydirectory/

ls: cannot access 'mydirectory/script.sh': Permission denied
ls: cannot access 'mydirectory/..': Permission denied
ls: cannot access 'mydirectory/subdirectory': Permission denied
ls: cannot access 'mydirectory/.': Permission denied
total 0
d????????? ? ? ? ?            ? .
d????????? ? ? ? ?            ? ..
-????????? ? ? ? ?            ? script.sh
d????????? ? ? ? ?            ? subdirectory
```

Важно отметить, что для просмотра каталога необходимы `execute` разрешения, независимо от уровня доступа пользователя. Кроме того, `execute` разрешения на каталог не позволяют пользователю выполнять или изменять какие-либо файлы или содержимое каталога, а только просматривать его и получать доступ к его содержимому.

Чтобы запускать файлы в каталоге, пользователю нужны `execute` разрешения на соответствующий файл. Чтобы изменять содержимое каталога (создавать, удалять или переименовывать файлы и подкаталоги), пользователю нужны `write` разрешения на каталог.

Вся система разрешений в Linux основана на восьмеричной системе счисления, и, по сути, существует три различных типа разрешений, которые могут быть назначены файлу или каталогу:

- (`r`) - Читать
- (`w`) - Написать
- (`x`) - Выполнить

Разрешения могут быть установлены для `owner`, `group`, и `others` как показано в следующем примере с соответствующими разрешениями.

  Управление разрешениями

```shell-session
cry0l1t3@htb[/htb]$ ls -l /etc/passwd

- rwx rw- r--   1 root root 1641 May  4 23:42 /etc/passwd
- --- --- ---   |  |    |    |   |__________|
|  |   |   |    |  |    |    |        |_ Date
|  |   |   |    |  |    |    |__________ File Size
|  |   |   |    |  |    |_______________ Group
|  |   |   |    |  |____________________ User
|  |   |   |    |_______________________ Number of hard links
|  |   |   |_ Permission of others (read)
|  |   |_____ Permissions of the group (read, write)
|  |_________ Permissions of the owner (read, write, execute)
|____________ File type (- = File, d = Directory, l = Link, ... )
```

---

## Изменение Разрешений

Мы можем изменить разрешения с помощью команды `chmod` и ссылок на группы разрешений (`u` — владелец, `g` — группа, `o` — другие, `a` — все пользователи), а также [`+`] или [`-`] для добавления или удаления указанных разрешений. В следующем примере предположим, что у нас есть файл с именем `shell` и мы хотим изменить его разрешения таким образом, чтобы этот скрипт принадлежал указанному пользователю, не был исполняемым и имел права на чтение и запись для всех пользователей.

  Управление разрешениями

```shell-session
cry0l1t3@htb[/htb]$ ls -l shell

-rwxr-x--x   1 cry0l1t3 htbteam 0 May  4 22:12 shell
```

Затем мы можем применить `read` разрешения для всех пользователей и увидеть результат.

  Управление разрешениями

```shell-session
cry0l1t3@htb[/htb]$ chmod a+r shell && ls -l shell

-rwxr-xr-x   1 cry0l1t3 htbteam 0 May  4 22:12 shell
```

Мы также можем установить разрешения для всех остальных пользователей на `read` только с помощью присвоения восьмеричного значения.

  Управление разрешениями

```shell-session
cry0l1t3@htb[/htb]$ chmod 754 shell && ls -l shell

-rwxr-xr--   1 cry0l1t3 htbteam 0 May  4 22:12 shell
```

Давайте рассмотрим все связанные с ним представления, чтобы лучше понять, как рассчитывается назначение разрешений.

  Управление разрешениями

```shell-session
Binary Notation:                4 2 1  |  4 2 1  |  4 2 1
----------------------------------------------------------
Binary Representation:          1 1 1  |  1 0 1  |  1 0 0
----------------------------------------------------------
Octal Value:                      7    |    5    |    4
----------------------------------------------------------
Permission Representation:      r w x  |  r - x  |  r - -
```

Если мы суммируем установленные биты из `Binary Representation` для значений из `Binary Notation` вместе, то получим `Octal Value`.`Permission Representation` представляет собой биты, установленные в `Binary Representation` с помощью трёх символов, которые упрощают распознавание установленных разрешений.

---

## Сменить Владельца

Чтобы изменить владельца и/или группу, к которой относится файл или каталог, мы можем использовать команду `chown` . Синтаксис выглядит следующим образом:

#### Синтаксис - chown

  Управление разрешениями

```shell-session
cry0l1t3@htb[/htb]$ chown <user>:<group> <file/directory>
```

В этом примере «оболочку» можно заменить любым произвольным файлом или папкой.

  Управление разрешениями

```shell-session
cry0l1t3@htb[/htb]$ chown root:root shell && ls -l shell

-rwxr-xr--   1 root root 0 May  4 22:12 shell
```

---

## SUID & SGID

Помимо назначения прямых разрешений для пользователей и групп, мы также можем настроить специальные разрешения для файлов, установив биты `Set User ID` (`SUID`) и `Set Group ID` (`SGID`). Эти биты `SUID`/`SGID` позволяют, например, пользователям запускать программы с правами другого пользователя. Администраторы часто используют это, чтобы предоставить своим пользователям специальные права для определённых приложений или файлов. Вместо "`s`" используется буква "`x`". При запуске такой программы используется SUID/SGID владельца файла.

Часто бывает так, что администраторы не знакомы с приложениями, но всё равно назначают биты SUID/SGID, что приводит к серьёзным рискам для безопасности. Такие программы могут содержать функции, которые позволяют запускать оболочку из пейджера, например, приложение «`journalctl`.»

Если администратор установит бит SUID на «`journalctl`», любой пользователь, имеющий доступ к этому приложению, сможет запустить оболочку от имени `root`. Более подробную информацию об этом и других подобных приложениях можно найти на [GTFObins](https://gtfobins.github.io/gtfobins/journalctl/).

---

## Липкий Кусочек

Биты фиксации — это тип разрешений для файлов в Linux, которые можно установить для каталогов. Этот тип разрешений обеспечивает дополнительный уровень безопасности при управлении удалением и переименованием файлов в каталоге. Обычно он используется для каталогов, которыми совместно пользуются несколько пользователей, чтобы предотвратить случайное удаление или переименование файлов, важных для других пользователей.

Например, в общем домашнем каталоге, к которому имеют доступ несколько пользователей, системный администратор может установить атрибут «только для чтения» для каталога, чтобы только владелец файла, владелец каталога или пользователь с правами суперпользователя могли удалять или переименовывать файлы в каталоге. Это означает, что другие пользователи не смогут удалять или переименовывать файлы в каталоге, так как у них нет необходимых разрешений. Это обеспечивает дополнительный уровень безопасности для защиты важных файлов, так как только пользователи с необходимыми правами могут удалять или переименовывать файлы. Установка атрибута «только чтение» для каталога гарантирует, что только владелец каталога, владелец каталога или пользователь root смогут изменять файлы в каталоге.

Если для каталога установлен флаг «только для чтения», он обозначается буквой «`t`» в разрешении на выполнение для каталога. Например, если для каталога установлено разрешение «`rwxrwxrwt`», это означает, что установлен флаг «только для чтения», что обеспечивает дополнительный уровень безопасности, чтобы никто, кроме владельца или пользователя с правами root, не мог удалить или переименовать файлы или папки в каталоге.

  Управление разрешениями

```shell-session
cry0l1t3@htb[/htb]$ ls -l

drw-rw-r-t 3 cry0l1t3 cry0l1t3   4096 Jan 12 12:30 scripts
drw-rw-r-T 3 cry0l1t3 cry0l1t3   4096 Jan 12 12:32 reports
```

В этом примере мы видим, что для обоих каталогов установлен флаг «закрепить». Однако в папке `reports` используется заглавная буква `T`, а в папке `scripts` — строчная `t`.

Если бирка с правами доступа написана заглавными буквами (`T`), это означает, что у всех остальных пользователей нет разрешений `execute` (`x`) и, следовательно, они не могут просматривать содержимое папки или запускать из неё какие-либо программы. Бирка с правами доступа, написанная строчными буквами (`t`), — это бирка с правами доступа, где установлены разрешения `execute` (`x`).