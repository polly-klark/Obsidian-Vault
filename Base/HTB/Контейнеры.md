#htb #docker 

`container` — это не виртуальная машина, а изолированная группа `processes` на одном хосте, которая соответствует целостному приложению, включая его конфигурацию и зависимости. Это приложение упаковано в чётко определённый формат, пригодный для повторного использования. В отличие от типичной виртуальной машины в VMware Workstation, контейнер не включает в себя собственную операционную систему или ядро. Таким образом, это не виртуализированная операционная система. По этой причине контейнеры значительно меньше обычных виртуальных машин. Поскольку на самом деле они не являются виртуальными машинами, в данном контексте их называют виртуализацией приложений.

![Сравнение виртуальных машин и контейнеров. Виртуальные машины имеют отдельную гостевую ОС для каждого приложения, работающую на гипервизоре. Контейнеры используют общую ОС и механизм контейнеров для изоляции приложений.](https://wiki.geant.org/download/attachments/184549510/containers-vs-virtual-machines.jpg?version=1&modificationDate=1607437321973&api=v2)

Ресурс: [https://wiki.geant.org](https://wiki.geant.org/download/attachments/184549510/containers-vs-virtual-machines.jpg?version=1&modificationDate=1607437321973&api=v2)

Существенной проблемой при развертывании новых приложений или новых версий является то, что каждое приложение зависит от определенных аспектов своей среды. К ним относятся, например, локальные настройки или библиотеки функций. Часто настройки в среде разработки отличаются от настроек в тестовой среде и рабочей среде. В результате может быстро сложиться ситуация, когда, вопреки ожиданиям, приложение в рабочей среде работает иначе или не работает вовсе.

|**Виртуальная машина**|`Container`|
|---|---|
|Содержит приложения и полную версию операционной системы|`Contain applications and only the necessary operating system components such as libraries and binaries`|
|Гипервизор, такой как VMware ESXi, обеспечивает виртуализацию|`The operating system with the container engine provides its own virtualization`|
|Несколько виртуальных машин работают изолированно друг от друга на физическом сервере|`Several containers run isolated from each other on one operating system`|

Контейнеры приложений технически основаны на функциях, которые уже некоторое время доступны в операционной системе Linux. Ядро использует эти функции для `isolate` приложений. Таким образом, приложения работают изолированно друг от друга как процессы в разных учётных записях пользователей. Однако они в то же время принадлежат к знакомой среде Linux. Также возможно взаимодействие различных приложений, и если контейнеры работают в одной системе, используется контейнерный демон — например, `Linux Container Daemon` (`LXD`). LXD — это технология, аналогичная `Linux Containers` (`LXC`). LXC — это технология виртуализации на основе контейнеров на уровне операционной системы. Технически LXC объединяет изолированные пространства имён и «cgroups» ядра Linux для реализации изолированных сред для выполнения кода. Исторически LXC также был основой для широко используемой технологии виртуализации Docker. С помощью LXD можно настраивать и контролировать контейнеры операционной системы Linux с помощью определённого набора команд. Таким образом, он подходит для автоматизации управления массовыми контейнерами и используется в облачных вычислениях и центрах обработки данных.

Образ файловой системы составляет основу каждого контейнера. Мы можем выбрать, использовать ли уже созданный образ или создать его самостоятельно. Контейнеры также отличаются превосходной масштабируемостью. Улучшенная масштабируемость идеально соответствует требованиям высокодинамичной ИТ-инфраструктуры современных компаний. Действительно, высокая масштабируемость контейнеров позволяет идеально адаптировать ресурсы для предоставления пользователям приложений. При этом даже большими контейнерными средами можно без проблем управлять с помощью систем оркестрации, таких как `Apache Mesos` или `Google Kubernetes`. Эти системы распределяют контейнеры по существующему оборудованию в соответствии с заранее заданными правилами и контролируют их работу.

---

## Введение в Docker

[Docker](https://www.docker.com/get-started) — это программное обеспечение с открытым исходным кодом, которое может изолировать приложения в контейнерах, подобно виртуализации операционной системы. Такой подход значительно упрощает развертывание приложений. Данные приложений, хранящиеся в контейнерах, можно легко переносить и устанавливать. Использование контейнеров обеспечивает строгое разделение компьютерных ресурсов. Docker хранит программы вместе с их зависимостями в образах. Они составляют основу для виртуализированных контейнеров, которые могут работать практически в любой операционной системе. Это делает приложения переносимыми и простыми в использовании как во время разработки, так и при масштабировании кластеров [SaaS](https://en.wikipedia.org/wiki/Software_as_a_service).

[Docker Engine](https://docs.docker.com/engine/) — это основной компонент виртуализации контейнеров. Программное обеспечение обеспечивает интерфейс между ресурсами хоста и работающими контейнерами. Любая система, в которой установлен Docker Engine, может использовать контейнеры Docker. Изначально Docker был разработан для использования в системах Linux. Однако при виртуализации с помощью VMware или Hyper-V движок также работает на устройствах Windows или Mac OS. Таким образом, Docker можно использовать практически во всех распространённых сценариях.

#### Установка Docker

  Контейнеры

```shell-session
cry0l1t3@htb:~$ sudo apt update -y 
cry0l1t3@htb:~$ sudo apt install docker.io -y
```

  Контейнеры

```powershell-session
C:\> IEX((new-object net.webclient).DownloadString('https://chocolatey.org/install.ps1'))
C:\> choco upgrade chocolatey
C:\> choco install docker-desktop
```

---

## Введение в Vagrant

[Vagrant](https://www.vagrantup.com/) — это инструмент, который может создавать, настраивать и управлять виртуальными машинами или средами виртуальных машин. Виртуальные машины создаются и настраиваются не вручную, а описываются как код в `Vagrantfile`. Для лучшей структуризации программного кода файл Vagrant может включать дополнительные файлы с кодом. Затем код можно обработать с помощью интерфейса командной строки Vagrant. Таким образом, мы можем создавать, настраивать и запускать собственные виртуальные машины. Более того, если виртуальные машины больше не нужны, их можно так же быстро и легко удалить. Изначально Vagrant предлагает провайдеров для VMware и Docker.

![Схема настройки Docker Swarm с использованием Vagrant и VirtualBox на хосте, реестре и трёх узлах Windows (sw-win-01, sw-win-02, sw-win-03).](https://stefanscherer.github.io/content/images/2016/03/windows_swarm_demo.png) Ресурс: https://stefanscherer.github.io/content/images/2016/03/windows_swarm_demo.png

#### Установка Vagrant

  Контейнеры

```shell-session
# Linux
cry0l1t3@htb:~$ sudo apt update -y 
cry0l1t3@htb:~$ sudo apt install virtualbox virtualbox-dkms vagrant
```

  Контейнеры

```powershell-session
# Windows
C:\> IEX((new-object net.webclient).DownloadString('https://chocolatey.org/install.ps1'))
C:\> choco upgrade chocolatey
C:\> cinst virtualbox cyg-get vagrant
```

---

Настоятельно рекомендуется поэкспериментировать с различными контейнерами, чтобы почувствовать их. Нам следует ознакомиться с документацией и прочитать её, чтобы понять, как работают контейнеры и от чего они зависят. Это также поможет нам понять, какие у них есть преимущества и недостатки.