#linux #htb 

Планирование задач — это функция в системах Linux, которая позволяет пользователям планировать и автоматизировать задачи. Она позволяет администраторам и пользователям запускать задачи в определённое время или с определённой периодичностью без необходимости запускать их вручную. Её можно использовать в системах Linux, таких как Ubuntu, Redhat Linux и Solaris, для управления различными задачами. Примеры включают автоматическое обновление программного обеспечения, запуск скриптов, очистку баз данных и автоматизацию резервного копирования. Это также позволяет пользователям планировать регулярные и повторяющиеся задачи, чтобы они выполнялись регулярно. Кроме того, можно настроить оповещения, которые будут отображаться при возникновении определённых событий или связываться с администраторами или пользователями. Существует множество различных вариантов использования автоматизации такого типа, но эти варианты охватывают большинство случаев.

---

## Systemd

Systemd — это служба, используемая в системах Linux, таких как Ubuntu, Redhat Linux и Solaris, для запуска процессов и скриптов в определённое время. С её помощью мы можем настроить запуск процессов и скриптов в определённое время или через определённый промежуток времени, а также указать конкретные события и триггеры, которые запустят определённую задачу. Для этого нам нужно выполнить некоторые действия и принять меры предосторожности, прежде чем наши скрипты или процессы будут автоматически запускаться системой.

1. Создайте таймер (планирует, когда ваш `mytimer.service` должен запуститься)
2. Создание сервиса (выполняет команды или скрипт)
3. Активируйте таймер

#### Создание таймера

Чтобы создать таймер для systemd, нам нужно создать каталог, в котором будет храниться сценарий таймера.

  Планирование задач

```shell-session
Barlogsha@htb[/htb]$ sudo mkdir /etc/systemd/system/mytimer.timer.d
Barlogsha@htb[/htb]$ sudo vim /etc/systemd/system/mytimer.timer
```

Далее нам нужно создать скрипт, который настроит таймер. Скрипт должен содержать следующие параметры: «Устройство», «Таймер» и «Установка». Параметр «Устройство» задаёт описание таймера. Параметр «Таймер» задаёт время запуска таймера и его активации. Наконец, параметр «Установка» задаёт место установки таймера.

#### Mytimer.таймер

Код: txt

```txt
[Unit]
Description=My Timer

[Timer]
OnBootSec=3min
OnUnitActiveSec=1hour

[Install]
WantedBy=timers.target
```

Здесь всё зависит от того, как мы хотим использовать наш скрипт. Например, если мы хотим запустить наш скрипт только один раз после загрузки системы, нам следует использовать `OnBootSec` в `Timer`. Однако если мы хотим, чтобы наш скрипт запускался регулярно, нам следует использовать `OnUnitActiveSec` для запуска скрипта через определённые промежутки времени. Далее нам нужно создать `service`.

#### Создание сервиса

  Планирование задач

```shell-session
Barlogsha@htb[/htb]$ sudo vim /etc/systemd/system/mytimer.service
```

Здесь мы задаём описание и указываем полный путь к скрипту, который хотим запустить. «multi-user.target» — это система, которая активируется при запуске в обычном многопользовательском режиме. Она определяет службы, которые должны запускаться при обычном запуске системы.

Код: txt

```txt
[Unit]
Description=My Service

[Service]
ExecStart=/full/path/to/my/script.sh

[Install]
WantedBy=multi-user.target
```

После этого мы должны снова позволить `systemd` прочитать папки, чтобы учесть изменения.

#### Перезагрузить Systemd

  Планирование задач

```shell-session
Barlogsha@htb[/htb]$ sudo systemctl daemon-reload
```

После этого мы можем использовать `systemctl` для `start` запуска службы вручную и `enable` автозапуска.

#### Запустите таймер и Сервисное обслуживание

  Планирование задач

```shell-session
Barlogsha@htb[/htb]$ sudo systemctl start mytimer.timer
Barlogsha@htb[/htb]$ sudo systemctl enable mytimer.timer
```

Таким образом, `mytimer.service` будет запускаться автоматически в соответствии с интервалами (или задержками), которые вы установили в `mytimer.timer`.

---

## Cron

Cron — это ещё один инструмент, который можно использовать в системах Linux для планирования и автоматизации процессов. Он позволяет пользователям и администраторам выполнять задачи в определённое время или с определёнными интервалами. В приведённых выше примерах мы также можем использовать Cron для автоматизации тех же задач. Нам просто нужно создать скрипт, а затем указать демону cron вызывать его в определённое время.

С помощью Cron мы можем автоматизировать те же задачи, но процесс настройки демона Cron немного отличается от настройки Systemd. Чтобы настроить демон Cron, нам нужно сохранить задачи в файле с именем `crontab` и указать демону, когда запускать задачи. Затем мы можем запланировать и автоматизировать задачи, настроив демон Cron соответствующим образом. Структура Cron состоит из следующих компонентов:

|**Временные Рамки**|**Описание**|
|---|---|
|Минуты (0-59)|Это указывает, в какую минуту должна быть выполнена задача.|
|Часы работы (0-23)|Это указывает, в какой час должна быть выполнена задача.|
|Дни месяца (1-31)|Это указывает, в какой день месяца задача должна быть выполнена.|
|Месяцы (1-12)|Это указывает, в каком месяце должна быть выполнена задача.|
|Дни недели (0-7)|Это указывает, в какой день недели должна быть выполнена задача.|

Например, такой crontab может выглядеть следующим образом:

Код: txt

```txt
# System Update
0 */6 * * * /path/to/update_software.sh

# Execute scripts
0 0 1 * * /path/to/scripts/run_scripts.sh

# Cleanup DB
0 0 * * 0 /path/to/scripts/clean_database.sh

# Backups
0 0 * * 7 /path/to/scripts/backup.sh
```

«Обновление системы» должно выполняться раз в шесть часов. Это указано в записи `0 */6` в столбце «Час». Задача выполняется скриптом `update_software.sh`, путь к которому указан в последнем столбце.

Задача `execute scripts` должна выполняться каждый первый день месяца в полночь. Это указано в записях `0` и `0` в столбцах «минуты» и «часы» и `1` в столбце «дни месяца». Задача выполняется скриптом `run_scripts.sh`, путь к которому указан в последнем столбце.

Третье задание, `Cleanup DB`, должно выполняться каждое воскресенье в полночь. Это указано в записях `0` и `0` в столбцах «минуты» и «часы», а также `0` в столбце «дни недели». Задание выполняется скриптом `clean_database.sh`, путь к которому указан в последнем столбце.

Четвёртое задание, `backups` должно выполняться каждое воскресенье в полночь. Это указано в записях `0` и `0` в столбцах «минуты» и «часы» и `7` в столбце «дни недели». Задание выполняется скриптом `backup.sh`, путь к которому указан в последнем столбце.

Также можно получать уведомления об успешном или неуспешном выполнении задачи. Кроме того, мы можем создавать журналы для отслеживания выполнения задач.

---

## Systemd против Cron

Systemd и Cron — это инструменты, которые можно использовать в системах Linux для планирования и автоматизации процессов. Ключевое различие между этими двумя инструментами заключается в их настройке. В Systemd вам нужно создать таймер и скрипт служб, который сообщает операционной системе, когда запускать задачи. С другой стороны, в Cron вам нужно создать `crontab` файл, который сообщает демону cron, когда запускать задачи.