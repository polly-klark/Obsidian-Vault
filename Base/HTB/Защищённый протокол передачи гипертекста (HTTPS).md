#htb #web #http 

В предыдущем разделе мы обсудили, как отправляются и обрабатываются HTTP-запросы. Однако одним из существенных недостатков HTTP является то, что все данные передаются в открытом виде. Это означает, что любой пользователь между источником и получателем может провести атаку типа «человек посередине» (MiTM) и просмотреть передаваемые данные.

Чтобы решить эту проблему, был создан [протокол HTTPS (HTTP Secure)](https://tools.ietf.org/html/rfc2660), в котором все данные передаются в зашифрованном виде, поэтому даже если третья сторона перехватит запрос, она не сможет извлечь из него данные. По этой причине HTTPS стал основным протоколом для веб-сайтов в интернете, а HTTP постепенно выводится из употребления, и вскоре большинство веб-браузеров не будут разрешать посещение веб-сайтов по протоколу HTTP.

---

## Обзор HTTPS

Если мы изучим HTTP-запрос, то увидим, к чему приводит отсутствие безопасного соединения между веб-браузером и веб-приложением. Например, вот содержимое HTTP-запроса для входа в систему: ![[Pasted image 20260114202341.png]]

Мы видим, что учётные данные для входа отображаются в открытом виде. Это позволяет любому пользователю в той же сети (например, в общедоступной беспроводной сети) перехватить запрос и повторно использовать учётные данные в злонамеренных целях.

Напротив, если кто-то перехватит и проанализирует трафик HTTPS-запроса, он увидит примерно следующее: ![[Pasted image 20260114202347.png]]

Как мы видим, данные передаются в виде единого зашифрованного потока, что значительно затрудняет получение такой информации, как учётные данные или любые другие конфиденциальные данные.

Веб-сайты, использующие протокол HTTPS, можно отличить по `https://` в URL-адресе (например, https://www.google.com), а также по значку замка в адресной строке браузера слева от URL-адреса. ![[Pasted image 20260114202354.png]]

Таким образом, если мы зайдём на сайт, использующий протокол HTTPS, например Google, весь трафик будет зашифрован.

**Примечание:** хотя данные, передаваемые по протоколу HTTPS, могут быть зашифрованы, запрос все равно может раскрыть посещаемый URL-адрес, если он будет отправлен на DNS-сервер с открытым текстом. По этой причине рекомендуется использовать зашифрованные DNS-серверы (например, 8.8.8.8 или 1.1.1.1) или VPN-сервис, чтобы обеспечить надлежащее шифрование всего трафика.

---

## Поток HTTPS

Давайте рассмотрим, как работает HTTPS на высоком уровне: ![[Pasted image 20260114202402.png]]

Если мы введём `http://` вместо `https://` для перехода на сайт, использующий HTTPS, браузер попытается определить домен и перенаправит пользователя на веб-сервер, на котором размещён целевой сайт. Сначала запрос отправляется на порт `80`, который использует незашифрованный протокол HTTP. Сервер определяет это и перенаправляет клиента на защищённый HTTPS-порт `443`. Это делается с помощью кода ответа `301 Moved Permanently`, который мы обсудим в следующем разделе.

Затем клиент (веб-браузер) отправляет пакет «приветствие клиента», содержащий информацию о нём. После этого сервер отвечает «приветствием сервера», а затем происходит [обмен ключами](https://en.wikipedia.org/wiki/Key_exchange) для обмена SSL-сертификатами. Клиент проверяет ключ/сертификат и отправляет свой собственный. После этого инициируется зашифрованное [рукопожатие](https://www.cloudflare.com/learning/ssl/what-happens-in-a-tls-handshake) для подтверждения правильности шифрования и передачи данных.

После успешного завершения рукопожатия продолжается обычная HTTP-коммуникация, которая после этого шифруется. Это очень общий обзор процесса обмена ключами, который выходит за рамки данного модуля.

**Примечание:** в зависимости от обстоятельств злоумышленник может провести HTTP-атаку, которая понижает уровень безопасности HTTPS-соединения до HTTP, в результате чего данные передаются в открытом виде. Для этого устанавливается прокси-сервер Man-In-The-Middle (MITM), который перенаправляет весь трафик через хост злоумышленника без ведома пользователя. Однако большинство современных браузеров, серверов и веб-приложений защищены от этой атаки.

---

## cURL для HTTPS

cURL должен автоматически поддерживать все стандарты HTTPS-связи, выполнять безопасное рукопожатие, а затем автоматически шифровать и расшифровывать данные. Однако если мы свяжемся с веб-сайтом, у которого недействительный или устаревший SSL-сертификат, cURL по умолчанию не будет поддерживать связь, чтобы защитить нас от упомянутых ранее атак типа «человек посередине»:

  Безопасный протокол передачи гипертекста (HTTPS)

```shell-session
Barlogsha@htb[/htb]$ curl https://inlanefreight.com

curl: (60) SSL certificate problem: Invalid certificate chain
More details here: https://curl.haxx.se/docs/sslcerts.html
...SNIP...
```

Современные веб-браузеры делают то же самое, предупреждая пользователя о том, что сайт использует недействительный SSL-сертификат.

Мы можем столкнуться с такой проблемой при тестировании локального веб-приложения или веб-приложения, размещенного в учебных целях, поскольку в таких веб-приложениях может еще не быть действующего SSL-сертификата. Чтобы пропустить проверку сертификата с помощью cURL, можно использовать флаг `-k`:

  Безопасный протокол передачи гипертекста (HTTPS)

```shell-session
Barlogsha@htb[/htb]$ curl -k https://www.inlanefreight.com

<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
...SNIP...
```

Как мы видим, на этот раз запрос был обработан и мы получили ответные данные.